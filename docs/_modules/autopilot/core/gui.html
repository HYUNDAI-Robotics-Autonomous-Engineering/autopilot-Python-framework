

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>autopilot.core.gui &mdash; Autopilot 0.2 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="docs.auto-pi-lot.com_modules/autopilot/core/gui.html"/>
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/autopilot_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

    <link href="https://fonts.googleapis.com/css?family=Cutive+Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:300,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dosis&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lexend+Deca&display=swap" rel="stylesheet">


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Autopilot
          

          
            
            <img src="../../../_static/autopilot_logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../guide.overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide.installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../guide.installation.pilot.html">Setup a Pilot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.installation.pilot.html#scripted-installation">Scripted Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.installation.pilot.html#manual-preinstall">Manual Preinstall</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.installation.pilot.html#rasbian-installation">Rasbian Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.installation.pilot.html#raspbian-performance-improvements">Raspbian Performance Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.installation.pilot.html#audio-setup">Audio Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.installation.pilot.html#video-setup">Video Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.installation.pilot.html#optional-installation-steps">Optional Installation Steps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide.installation.terminal.html">Setup a Terminal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.installation.terminal.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.installation.terminal.html#scripted-terminal-setup">Scripted Terminal Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.installation.terminal.html#manual-terminal-presetup">Manual Terminal Presetup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.installation.terminal.html#compiling-installing-qt4-linux">Compiling &amp; Installing Qt4 - Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.installation.terminal.html#installing-qt4-macos">Installing Qt4 - MacOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.installation.terminal.html#compiling-installing-pyside-linux-macos">Compiling &amp; Installing PySide - Linux + macOS</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide.training.html">Training a Subject</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../guide.training.html#connecting-the-pilot">Connecting the Pilot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide.training.html#creating-a-protocol">Creating a Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.training.html#using-the-protocol-wizard">Using the Protocol Wizard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.training.html#manual-protocol-creation">Manual Protocol Creation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide.training.html#creating-a-subject">Creating a Subject</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide.training.html#running-the-task">Running the Task</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide.training.html#debugging-a-task">Debugging a Task</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide.task.html">Writing a Task</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../guide.task.html#the-nafc-task">The Nafc Task</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#the-task-class">The <code class="docutils literal notranslate"><span class="pre">Task</span></code> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#four-task-attributes">Four Task Attributes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.task.html#params">PARAMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.task.html#data">Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.task.html#plot">PLOT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.task.html#hardware">HARDWARE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#initialization">Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#stage-methods">Stage Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.task.html#request">Request</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.task.html#discrim">Discrim</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../guide.task.html#reinforcement">Reinforcement</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#additional-methods">Additional Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide.task.html#distributed-go-no-go-using-child-agents">Distributed Go/No-Go - Using Child Agents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#additional-prefs">Additional Prefs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#go-no-go-parameterization">Go/No-Go Parameterization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#id5">Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#the-child-task">The Child Task</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#a-very-smart-wheel">A Very Smart Wheel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../guide.task.html#go-no-go-stage-methods">Go/No-Go Stage Methods</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide.hardware.html">Writing a Hardware Class</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autopilot.core.html">Core Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.core.gui.html">gui</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.core.hardware.html">hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.core.networking.html">networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.core.pilot.html">pilot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.core.plots.html">plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.core.subject.html">mouse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.core.terminal.html">terminal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.core.utils.html">utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autopilot.tasks.html">Tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.tasks.free_water.html">free_water</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.tasks.graduation.html">graduation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.tasks.nafc.html">nafc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.tasks.task.html">task</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autopilot.stim.html">Stimuli</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.stim.managers.html">managers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.stim.sound.html">sound</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../autopilot.stim.sound.jackclient.html">jackclient</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autopilot.stim.sound.pyoserver.html">pyoserver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autopilot.stim.sound.sounds.html">sounds</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autopilot.viz.html">Visualization Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.viz.trial_viewer.html">trial_viewer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autopilot.setup.html">Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.setup.setup_pilot.html">setup_pilot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.setup.setup_scale.html">setup_scale</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autopilot.setup.setup_terminal.html">setup_terminal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autopilot.prefs.html">Prefs</a></li>
</ul>
<p class="caption"><span class="caption-text">Meta:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../todo.html">To-Do</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Autopilot</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>autopilot.core.gui</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for autopilot.core.gui</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Note:</span>
<span class="sd">    Let&#39;s start by saying all the GUI code is a little screwy.</span>

<span class="sd">    It was developed before much of the rest of the package, and</span>
<span class="sd">    thus has some severe violations of modularity - passing</span>
<span class="sd">    methods back and forth between objects, etc.</span>

<span class="sd">    AKA it was developed much before I knew how Python worked.</span>

<span class="sd">    That being said...</span>

<span class="sd">These classes implement the GUI used by the Terminal.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span> <span class="k">as</span> <span class="n">odict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">PySide</span> <span class="kn">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="kn">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="c1"># adding autopilot parent directory to path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))</span>
<span class="kn">from</span> <span class="nn">autopilot.core.subject</span> <span class="kn">import</span> <span class="n">Subject</span>
<span class="kn">from</span> <span class="nn">autopilot</span> <span class="kn">import</span> <span class="n">tasks</span><span class="p">,</span> <span class="n">prefs</span>
<span class="kn">from</span> <span class="nn">autopilot.stim.sound</span> <span class="kn">import</span> <span class="n">sounds</span>
<span class="kn">from</span> <span class="nn">autopilot.core.networking</span> <span class="kn">import</span> <span class="n">Net_Node</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">autopilot.core.utils</span> <span class="kn">import</span> <span class="n">InvokeEvent</span>
<span class="kn">from</span> <span class="nn">autopilot.core.plots</span> <span class="kn">import</span> <span class="n">gui_event</span>

<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">time</span>


<div class="viewcode-block" id="gui_event"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.gui_event">[docs]</a><span class="k">def</span> <span class="nf">gui_event</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper/decorator around an event that posts GUI events back to the main</span>
<span class="sd">    thread that our window is running in.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn (callable): a function that does something to the GUI</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper_gui_event</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># type: (object, object) -&gt; None</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            *args ():</span>
<span class="sd">            **kwargs ():</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">postEvent</span><span class="p">(</span><span class="n">prefs</span><span class="o">.</span><span class="n">INVOKER</span><span class="p">,</span> <span class="n">InvokeEvent</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">wrapper_gui_event</span></div>


<div class="viewcode-block" id="Control_Panel"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Control_Panel">[docs]</a><span class="k">class</span> <span class="nc">Control_Panel</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A :class:`QtGui.QWidget` that contains the controls for all pilots.</span>

<span class="sd">    Specifically, for each pilot, it contains</span>

<span class="sd">    * one :class:`subject_List`: A list of the subjects that run in each pilot.</span>
<span class="sd">    * one :class:`Pilot_Panel`: A set of button controls for starting/stopping behavior</span>

<span class="sd">    This class should not be instantiated outside the context of a</span>
<span class="sd">    :py:class:`~.terminal.Terminal` object, as they share the :py:attr:`.subjects` dictionary.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        subjects (dict): A dictionary with subject ID&#39;s as keys and</span>
<span class="sd">                :class:`core.subject.Subject` objects as values. Shared with the</span>
<span class="sd">                Terminal object to manage access conflicts.</span>
<span class="sd">        start_fn (:py:meth:`~autopilot.core.terminal.Terminal.toggle_start`): See :py:attr:`.Control_Panel.start_fn`</span>
<span class="sd">        pilots (dict): A dictionary with pilot ID&#39;s as keys and nested dictionaries</span>
<span class="sd">                    containing subjects, IP, etc. as values</span>
<span class="sd">        subject_lists (dict): A dict mapping subject ID to :py:class:`.subject_List`</span>
<span class="sd">        layout (:py:class:`~QtGui.QGridLayout`): Layout grid for widget</span>
<span class="sd">        panels (dict): A dict mapping pilot name to the relevant :py:class:`.Pilot_Panel`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Hosts two nested tab widgets to select pilot and subject,</span>
    <span class="c1"># set params, run subjects, etc.</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subjects</span><span class="p">,</span> <span class="n">start_fn</span><span class="p">,</span> <span class="n">pilots</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            subjects (dict): See :py:attr:`.Control_Panel.subjects`</span>
<span class="sd">            start_fn (:py:meth:`~autopilot.core.terminal.Terminal.toggle_start`): the Terminal&#39;s</span>
<span class="sd">                toggle_start function, propagated down to each :class:`~core.gui.Pilot_Button`</span>
<span class="sd">            pilots: Usually the Terminal&#39;s :py:attr:`~.Terminal.pilots` dict. If not passed,</span>
<span class="sd">                will try to load :py:attr:`.params.PILOT_DB`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Control_Panel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># We share a dict of subject objects with the main Terminal class to avoid access conflicts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="o">=</span> <span class="n">subjects</span>

        <span class="c1"># We get the Terminal&#39;s send_message function so we can communicate directly from here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_fn</span> <span class="o">=</span> <span class="n">start_fn</span>

        <span class="k">if</span> <span class="n">pilots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span> <span class="o">=</span> <span class="n">pilots</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Try finding prefs in the encapsulating namespaces</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefs</span><span class="o">.</span><span class="n">PILOT_DB</span><span class="p">)</span> <span class="k">as</span> <span class="n">pilot_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pilot_file</span><span class="p">,</span> <span class="n">object_pairs_hook</span><span class="o">=</span><span class="n">odict</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/usr/autopilot/pilot_db.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pilot_file</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pilot_file</span><span class="p">,</span> <span class="n">object_pairs_hook</span><span class="o">=</span><span class="n">odict</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                    <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Couldnt find pilot directory!&#39;</span><span class="p">)</span>

        <span class="c1"># Make dict to store handles to subjects lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject_lists</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Set layout for whole widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">panels</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">,</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">)</span>

<div class="viewcode-block" id="Control_Panel.init_ui"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Control_Panel.init_ui">[docs]</a>    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called on init, creates the UI components.</span>

<span class="sd">        Specifically, for each pilot in :py:attr:`.pilots`,</span>
<span class="sd">        make a :class:`subject_List`: and :class:`Pilot_Panel`:,</span>
<span class="sd">        set size policies and connect Qt signals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setColumnStretch</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setColumnStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Iterate through pilots and subjects, making start/stop buttons for pilots and lists of subjects</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pilot</span><span class="p">,</span> <span class="n">subjects</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilots</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="c1"># in pilot dict, format is {&#39;pilot&#39;:{&#39;subjects&#39;:[&#39;subject1&#39;,...],&#39;ip&#39;:&#39;&#39;,etc.}}</span>
            <span class="n">subjects</span> <span class="o">=</span> <span class="n">subjects</span><span class="p">[</span><span class="s1">&#39;subjects&#39;</span><span class="p">]</span>
            <span class="c1"># Make a list of subjects</span>
            <span class="n">subject_list</span> <span class="o">=</span> <span class="n">Subject_List</span><span class="p">(</span><span class="n">subjects</span><span class="p">,</span> <span class="n">drop_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_db</span><span class="p">)</span>
            <span class="n">subject_list</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
            <span class="c1">#subject_list.itemDoubleClicked.connect(self.edit_params)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subject_lists</span><span class="p">[</span><span class="n">pilot</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject_list</span>

            <span class="c1"># Make a panel for pilot control</span>
            <span class="n">pilot_panel</span> <span class="o">=</span> <span class="n">Pilot_Panel</span><span class="p">(</span><span class="n">pilot</span><span class="p">,</span> <span class="n">subject_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_fn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subject</span><span class="p">)</span>
            <span class="n">pilot_panel</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">panels</span><span class="p">[</span><span class="n">pilot</span><span class="p">]</span> <span class="o">=</span> <span class="n">pilot_panel</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pilot_panel</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">subject_list</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Control_Panel.create_subject"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Control_Panel.create_subject">[docs]</a>    <span class="k">def</span> <span class="nf">create_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pilot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Becomes :py:attr:`.Pilot_Panel.create_fn`.</span>
<span class="sd">        Opens a :py:class:`.New_Subject_Wizard` to create a new subject file and assign protocol.</span>
<span class="sd">        Finally, adds the new subject to the :py:attr:`~.Control_Panel.pilots` database and updates it.</span>

<span class="sd">        Args:</span>
<span class="sd">            pilot (str): Pilot name passed from :py:class:`.Pilot_Panel`, added to the created Subject object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_subject_wizard</span> <span class="o">=</span> <span class="n">New_Subject_Wizard</span><span class="p">()</span>
        <span class="n">new_subject_wizard</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="c1"># If the wizard completed successfully, get its values</span>
        <span class="k">if</span> <span class="n">new_subject_wizard</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">biography_vals</span> <span class="o">=</span> <span class="n">new_subject_wizard</span><span class="o">.</span><span class="n">bio_tab</span><span class="o">.</span><span class="n">values</span>
            <span class="c1"># TODO: Make a &quot;session&quot; history table that stashes pilot, git hash, step, etc. for each session - subjects might run on different pilots</span>
            <span class="n">biography_vals</span><span class="p">[</span><span class="s1">&#39;pilot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pilot</span>

            <span class="c1"># Make a new subject object, make it temporary because we want to close it</span>
            <span class="n">subject_obj</span> <span class="o">=</span> <span class="n">Subject</span><span class="p">(</span><span class="n">biography_vals</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">new</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                <span class="n">biography</span><span class="o">=</span><span class="n">biography_vals</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span><span class="p">[</span><span class="n">biography_vals</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">subject_obj</span>

            <span class="c1"># If a protocol was selected in the subject wizard, assign it.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">protocol_vals</span> <span class="o">=</span> <span class="n">new_subject_wizard</span><span class="o">.</span><span class="n">task_tab</span><span class="o">.</span><span class="n">values</span>
                <span class="k">if</span> <span class="s1">&#39;protocol&#39;</span> <span class="ow">in</span> <span class="n">protocol_vals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;step&#39;</span> <span class="ow">in</span> <span class="n">protocol_vals</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">protocol_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefs</span><span class="o">.</span><span class="n">PROTOCOLDIR</span><span class="p">,</span> <span class="n">protocol_vals</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
                    <span class="n">subject_obj</span><span class="o">.</span><span class="n">assign_protocol</span><span class="p">(</span><span class="n">protocol_file</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">protocol_vals</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># the wizard couldn&#39;t find the protocol dir, so no task tab was made</span>
                <span class="c1"># or no task was assigned</span>
                <span class="k">pass</span>

            <span class="c1"># Add subject to pilots dict, update it and our tabs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span><span class="p">[</span><span class="n">pilot</span><span class="p">][</span><span class="s1">&#39;subjects&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">biography_vals</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subject_lists</span><span class="p">[</span><span class="n">pilot</span><span class="p">]</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">biography_vals</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_db</span><span class="p">()</span></div>

    <span class="c1"># TODO: fix this</span>
    <span class="c1"># def edit_params(self, item):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#         item:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     # edit a subject&#39;s task parameters, called when subject double-clicked</span>
    <span class="c1">#     subject = item.text()</span>
    <span class="c1">#     if subject not in self.subjects.keys():</span>
    <span class="c1">#         self.subjects[subject] = Subject(subject)</span>
    <span class="c1">#</span>
    <span class="c1">#     if &#39;/current&#39; not in self.subjects[subject].h5f:</span>
    <span class="c1">#         Warning(&quot;Subject {} has no protocol!&quot;.format(subject))</span>
    <span class="c1">#         return</span>
    <span class="c1">#</span>
    <span class="c1">#     protocol = self.subjects[subject].current</span>
    <span class="c1">#     step = self.subjects[subject].step</span>
    <span class="c1">#</span>
    <span class="c1">#     protocol_edit = Protocol_Parameters_Dialogue(protocol, step)</span>
    <span class="c1">#     protocol_edit.exec_()</span>
    <span class="c1">#</span>
    <span class="c1">#     if protocol_edit.result() == 1:</span>
    <span class="c1">#         param_changes = protocol_edit.step_changes</span>
    <span class="c1">#         # iterate through steps, checking for changes</span>
    <span class="c1">#         for i, step_changes in enumerate(param_changes):</span>
    <span class="c1">#             # if there are any changes to this step, stash them</span>
    <span class="c1">#             if step_changes:</span>
    <span class="c1">#                 for k, v in step_changes.items():</span>
    <span class="c1">#                     self.subjects[subject].update_history(&#39;param&#39;, k, v, step=i)</span>
    <span class="c1">#</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="Control_Panel.update_db"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Control_Panel.update_db">[docs]</a>    <span class="k">def</span> <span class="nf">update_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gathers any changes in :class:`Subject_List` s and dumps :py:attr:`.pilots` to :py:attr:`.prefs.PILOT_DB`</span>

<span class="sd">        Args:</span>
<span class="sd">            kwargs: Create new pilots by passing a dictionary with the structure</span>

<span class="sd">                `new={&#39;pilot_name&#39;:&#39;pilot_values&#39;}`</span>

<span class="sd">                where `&#39;pilot_values&#39;` can be nothing, a list of subjects,</span>
<span class="sd">                or any other information included in the pilot db</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># gather subjects from lists</span>
        <span class="k">for</span> <span class="n">pilot</span><span class="p">,</span> <span class="n">mlist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_lists</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">subjects</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mlist</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                <span class="n">subjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mlist</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span><span class="p">[</span><span class="n">pilot</span><span class="p">][</span><span class="s1">&#39;subjects&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subjects</span>

        <span class="c1"># if we were given a new pilot, add it</span>
        <span class="k">if</span> <span class="s1">&#39;new&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pilot</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span><span class="p">[</span><span class="n">pilot</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># strip any state that&#39;s been stored</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefs</span><span class="o">.</span><span class="n">PILOT_DB</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pilot_file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilots</span><span class="p">,</span> <span class="n">pilot_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/usr/autopilot/pilot_db.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pilot_file</span><span class="p">:</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilots</span><span class="p">,</span> <span class="n">pilot_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Couldnt update pilot db!&#39;</span><span class="p">)</span></div></div>

<span class="c1">####################################</span>
<span class="c1"># Control Panel Widgets</span>
<span class="c1">###################################</span>

<div class="viewcode-block" id="Subject_List"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Subject_List">[docs]</a><span class="k">class</span> <span class="nc">Subject_List</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QListWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A trivial modification of :class:`~.QtGui.QListWidget` that updates</span>
<span class="sd">    :py:attr:`~.Terminal.pilots` when an item in the list is dragged to another location.</span>

<span class="sd">    Should not be initialized except by :class:`.Control_Panel` .</span>

<span class="sd">    Attributes:</span>
<span class="sd">        subjects (list): A list of subjects ID&#39;s passed by :class:`.Control_Panel`</span>
<span class="sd">        drop_fn (:py:meth:`.Control_Panel.update_db`): called on a drop event</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subjects</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">drop_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            subjects: see :py:attr:`~.Subject_List.subjects`. Can be `None` for an empty list</span>
<span class="sd">            drop_fn: see :py:meth:`~.Subject_List.drop_fn`. Passed from :class:`.Control_Panel`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Subject_List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># if we are passed a list of subjects, populate</span>
        <span class="k">if</span> <span class="n">subjects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="o">=</span> <span class="n">subjects</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_list</span><span class="p">()</span>

        <span class="c1"># make draggable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDragDropMode</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">InternalMove</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDragDropOverwriteMode</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAcceptDrops</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># drop_fn gets called on a dropEvent (after calling the superclass method)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_fn</span> <span class="o">=</span> <span class="n">drop_fn</span>

<div class="viewcode-block" id="Subject_List.populate_list"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Subject_List.populate_list">[docs]</a>    <span class="k">def</span> <span class="nf">populate_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds each item in :py:attr:`Subject_List.subjects` to the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">m</span><span class="p">)</span></div>

<div class="viewcode-block" id="Subject_List.dropEvent"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Subject_List.dropEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dropEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A trivial redefinition of :py:meth:`.QtGui.QListWidget.dropEvent`</span>
<span class="sd">        that calls the parent `dropEvent` and then calls :py:attr:`~.Subject_List.drop_fn`</span>

<span class="sd">        Args:</span>
<span class="sd">            event: A :class:`.QtCore.QEvent` simply forwarded to the superclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># call the parent dropEvent to make sure all the list ops happen</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Subject_List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dropEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># then we call the drop_fn passed to us</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_fn</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Pilot_Panel"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Panel">[docs]</a><span class="k">class</span> <span class="nc">Pilot_Panel</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A little panel with</span>

<span class="sd">    * the name of a pilot,</span>
<span class="sd">    * A :class:`Pilot_Button` to start and stop the task</span>
<span class="sd">    * Add and remove buttons to :py:meth:`~Pilot_Panel.create_subject` and :py:meth:`Pilot_Panel.remove_subject`</span>

<span class="sd">    Note:</span>
<span class="sd">        This class should not be instantiated except by :class:`Control_Panel`</span>

<span class="sd">    Attributes:</span>
<span class="sd">        layout (:py:class:`QtGui.QGridLayout`): Layout for UI elements</span>
<span class="sd">        button (:class:`.Pilot_Button`): button used to control a pilot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pilot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">subject_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">start_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">create_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            pilot (str): The name of the pilot this panel controls</span>
<span class="sd">            subject_list (:py:class:`.Subject_List`): The :py:class:`.Subject_List` we control</span>
<span class="sd">            start_fn (:py:meth:`~autopilot.core.terminal.Terminal.toggle_start`): Passed by :class:`Control_Panel`</span>
<span class="sd">            create_fn (:py:meth:`Control_Panel.create_subject`): Passed by :class:`Control_Panel`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Pilot_Panel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pilot</span> <span class="o">=</span> <span class="n">pilot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject_list</span> <span class="o">=</span> <span class="n">subject_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_fn</span> <span class="o">=</span> <span class="n">start_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_fn</span> <span class="o">=</span> <span class="n">create_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

<div class="viewcode-block" id="Pilot_Panel.init_ui"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Panel.init_ui">[docs]</a>    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes UI elements - creates widgets and adds to :py:attr:`Pilot_Panel.layout` .</span>
<span class="sd">        Called on init.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># type: () -&gt; None</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font: bold 14pt; text-align:right;&quot;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">Pilot_Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_fn</span><span class="p">)</span>
        <span class="n">add_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
        <span class="n">add_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_subject</span><span class="p">)</span>
        <span class="n">add_button</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="n">remove_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">remove_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_subject</span><span class="p">)</span>
        <span class="n">remove_button</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">add_button</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">remove_button</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setRowStretch</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setRowStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setRowStretch</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pilot_Panel.remove_subject"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Panel.remove_subject">[docs]</a>    <span class="k">def</span> <span class="nf">remove_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the currently selected subject in :py:attr:`Pilot_Panel.subject_list`,</span>
<span class="sd">        and calls the :py:meth:`Control_Panel.update_db` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">current_subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_list</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">msgbox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
        <span class="n">msgbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(only removes from pilot_db.json, data will not be deleted)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_subject</span><span class="p">))</span>

        <span class="n">msgBox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
        <span class="n">msgBox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Are you sure you would like to remove {}?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_subject</span><span class="p">))</span>
        <span class="n">msgBox</span><span class="o">.</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s2">&quot;&#39;Yes&#39; only removes from pilot_db.json, data will not be deleted&quot;</span><span class="p">)</span>
        <span class="n">msgBox</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
        <span class="n">msgBox</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">msgBox</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">subject_list</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subject_list</span><span class="o">.</span><span class="n">currentRow</span><span class="p">())</span>
            <span class="c1"># the drop fn updates the db</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subject_list</span><span class="o">.</span><span class="n">drop_fn</span><span class="p">()</span></div>

<div class="viewcode-block" id="Pilot_Panel.create_subject"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Panel.create_subject">[docs]</a>    <span class="k">def</span> <span class="nf">create_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Just calls :py:meth:`Control_Panel.create_subject` with our `pilot` as the argument</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Pilot_Button"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Button">[docs]</a><span class="k">class</span> <span class="nc">Pilot_Button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pilot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">subject_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">start_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A subclass of (toggled) :class:`QtGui.QPushButton` that incorporates the style logic of a</span>
<span class="sd">        start/stop button - ie. color, text.</span>

<span class="sd">        Starts grayed out, turns green if contact with a pilot is made.</span>

<span class="sd">        Args:</span>
<span class="sd">            pilot (str): The ID of the pilot that this button controls</span>
<span class="sd">            subject_list (:py:class:`.Subject_List`): The Subject list used to determine which</span>
<span class="sd">                subject is starting/stopping</span>
<span class="sd">            start_fn (:py:meth:`~autopilot.core.terminal.Terminal.toggle_start`): The final</span>
<span class="sd">                resting place of the toggle_start method</span>

<span class="sd">        Attributes:</span>
<span class="sd">            state (str): The state of our pilot, reflected in our graphical properties.</span>
<span class="sd">                Mirrors :attr:`~.pilot.Pilot.state` , with an additional &quot;DISCONNECTED&quot;</span>
<span class="sd">                state for before contact is made with the pilot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Pilot_Button</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1">## GUI Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QPushButton {color:white; background-color: green}&quot;</span>
                           <span class="s2">&quot;QPushButton:checked {color:white; background-color: red}&quot;</span>
                           <span class="s2">&quot;QPushButton:disabled {color:black; background-color: gray}&quot;</span><span class="p">)</span>
        <span class="c1"># at start, set our text to no pilot and wait for the signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span>

        <span class="c1"># keep track of our visual and functional state.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;DISCONNECTED&quot;</span>

        <span class="c1"># Normally buttons only expand horizontally, but these big ole ones....</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>

        <span class="c1"># What&#39;s yr name anyway?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pilot</span> <span class="o">=</span> <span class="n">pilot</span>

        <span class="c1"># What subjects do we know about?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject_list</span> <span class="o">=</span> <span class="n">subject_list</span>



        <span class="c1"># Passed a function to toggle start from the control panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_fn</span> <span class="o">=</span> <span class="n">start_fn</span>
        <span class="c1"># toggle_start has a little sugar on it before sending to control panel</span>
        <span class="c1"># use the clicked rather than toggled signal, clicked only triggers on user</span>
        <span class="c1"># interaction, toggle is whenever the state is toggled - so programmatically</span>
        <span class="c1"># toggling the button - ie. responding to pilot state changes - double triggers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_start</span><span class="p">)</span>


<div class="viewcode-block" id="Pilot_Button.toggle_start"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Button.toggle_start">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Minor window dressing to call the :py:meth:`~.Pilot_Button.start_fn` with the</span>
<span class="sd">        appropriate pilot, subject, and whether the task is starting or stopping</span>

<span class="sd">        Args:</span>
<span class="sd">            toggled (bool): T/F this button is now toggled down (starting the task) or vice versa.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If we&#39;re stopped, start, and vice versa...</span>
        <span class="n">current_subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_list</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">current_subject</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="ne">Warning</span><span class="p">(</span><span class="s2">&quot;Start button clicked, but no subject selected.&quot;</span><span class="p">)</span>
            <span class="k">return</span>


        <span class="n">toggled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">toggled</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="c1"># ie button is already down, already running.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;STOP&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_fn</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pilot</span><span class="p">,</span> <span class="n">current_subject</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;START&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_fn</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pilot</span><span class="p">,</span> <span class="n">current_subject</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pilot_Button.set_state"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Button.set_state">[docs]</a>    <span class="nd">@gui_event</span>
    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="c1"># if we&#39;re good, do nothing.</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;IDLE&quot;</span><span class="p">:</span>
            <span class="c1"># responsive and waiting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;START&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;RUNNING&quot;</span><span class="p">:</span>
            <span class="c1"># running a task</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;STOP&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;STOPPING&quot;</span><span class="p">:</span>
            <span class="c1"># stopping</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;STOPPING&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;DISCONNECTED&quot;</span><span class="p">:</span>
            <span class="c1"># contact w the pi is missing or lost</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;DISCONNECTED&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;STOP&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;START&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span></div></div>


<span class="c1">##################################</span>
<span class="c1"># Wizard Widgets</span>
<span class="c1">################################3#</span>

<span class="c1"># TODO: Change these classes to use the update params windows</span>

<div class="viewcode-block" id="New_Subject_Wizard"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.New_Subject_Wizard">[docs]</a><span class="k">class</span> <span class="nc">New_Subject_Wizard</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A popup that prompts you to define variables for a new :class:`.subject.Subject` object</span>

<span class="sd">    Called by :py:meth:`.Control_Panel.create_subject` , which handles actually creating</span>
<span class="sd">    the subject file and updating the :py:attr:`.Terminal.pilots` dict and file.</span>

<span class="sd">    Contains two tabs</span>
<span class="sd">    - :class:`~.New_Subject_Wizard.Biography_Tab` - to set basic biographical information about a subject</span>
<span class="sd">    - :class:`~.New_Subject_Wizard.Task_Tab` - to set the protocol and step to start the subject on</span>

<span class="sd">    Attributes:</span>
<span class="sd">        protocol_dir (str): A full path to where protocols are stored,</span>
<span class="sd">            received from :py:const:`.prefs.PROTOCOLDIR`</span>
<span class="sd">        bio_tab (:class:`~.New_Subject_Wizard.Biography_Tab`): Sub-object to set and store biographical variables</span>
<span class="sd">        task_tab (:class:`~.New_Subject_Wizard.Task_Tab`): Sub-object to set and store protocol and step assignment</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">protocol_dir</span> <span class="o">=</span> <span class="n">prefs</span><span class="o">.</span><span class="n">PROTOCOLDIR</span>

        <span class="n">tabWidget</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTabWidget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bio_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Biography_Tab</span><span class="p">()</span>
        <span class="n">tabWidget</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bio_tab</span><span class="p">,</span> <span class="s2">&quot;Biography&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">task_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Task_Tab</span><span class="p">()</span>
            <span class="n">tabWidget</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_tab</span><span class="p">,</span> <span class="s2">&quot;Protocol&quot;</span><span class="p">)</span>

        <span class="n">buttonBox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="n">buttonBox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>

        <span class="n">mainLayout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">tabWidget</span><span class="p">)</span>
        <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">buttonBox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">mainLayout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Setup New Subject&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="New_Subject_Wizard.Biography_Tab"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.New_Subject_Wizard.Biography_Tab">[docs]</a>    <span class="k">class</span> <span class="nc">Biography_Tab</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A widget that allows defining basic biographical attributes about a subject</span>

<span class="sd">        Creates a set of widgets connected to :py:meth:`~.Biography_Tab.update_return_dict` that stores the parameters.</span>

<span class="sd">        Warning:</span>
<span class="sd">            The below attributes are **not** the object attributes, but are descriptions of the parameters</span>
<span class="sd">            available in the values dictionary. The attributes themselves are PySide Widgets that set the values.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            id (str): A Subject&#39;s ID or name</span>
<span class="sd">            start_date (str): The date the subject started the task. Automatically filled by</span>
<span class="sd">                :py:meth:`datetime.date.today().isoformat()`</span>
<span class="sd">            blmass (float): The subject&#39;s baseline mass</span>
<span class="sd">            minmass_pct (int): The percentage of baseline mass that a water restricted subject is allowed to reach</span>
<span class="sd">            minmass (float): The subject&#39;s minimum mass, automatically calculated `blmass * (minmass_pct / 100.)`</span>
<span class="sd">            genotype (str): A string describing the subject&#39;s genotype</span>
<span class="sd">            expt (str): A tag to describe what experiment this subject is a part of</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Input Labels</span>
            <span class="n">ID_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;ID:&quot;</span><span class="p">)</span>
            <span class="n">start_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Start Date:&quot;</span><span class="p">)</span>
            <span class="n">blmass_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Baseline Mass:&quot;</span><span class="p">)</span>
            <span class="n">minmasspct_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f Baseline Mass:&quot;</span><span class="p">)</span>
            <span class="n">minmass_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Minimum Mass:&quot;</span><span class="p">)</span>
            <span class="n">genotype_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Genotype:&quot;</span><span class="p">)</span>
            <span class="n">expt_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Experiment Tag:&quot;</span><span class="p">)</span>

            <span class="c1"># Input widgets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blmass</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blmass</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDoubleValidator</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blmass</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmass_pct</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSpinBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmass_pct</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmass_pct</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmass_pct</span><span class="o">.</span><span class="n">setSuffix</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmass_pct</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmass</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmass</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDoubleValidator</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minmass</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">genotype</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expt</span>     <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>

            <span class="c1"># Set return dictionary signals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_return_dict</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_return_dict</span><span class="p">(</span><span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blmass</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_return_dict</span><span class="p">(</span><span class="s1">&#39;baseline_mass&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blmass</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmass</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_return_dict</span><span class="p">(</span><span class="s1">&#39;min_mass&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minmass</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">genotype</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_return_dict</span><span class="p">(</span><span class="s1">&#39;genotype&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">genotype</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expt</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_return_dict</span><span class="p">(</span><span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expt</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>

            <span class="c1"># Set update minmass signals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blmass</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_minmass</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmass_pct</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_minmass</span><span class="p">)</span>

            <span class="c1"># Setup Layout</span>
            <span class="n">mainLayout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ID_label</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">start_label</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">blmass_label</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blmass</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">minmasspct_label</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minmass_pct</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">minmass_label</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minmass</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">genotype_label</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genotype</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">expt_label</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expt</span><span class="p">)</span>
            <span class="n">mainLayout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">mainLayout</span><span class="p">)</span>

            <span class="c1"># Dictionary to return values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="New_Subject_Wizard.Biography_Tab.update_return_dict"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.New_Subject_Wizard.Biography_Tab.update_return_dict">[docs]</a>        <span class="k">def</span> <span class="nf">update_return_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Called by lambda functions by the widgets, eg.::</span>

<span class="sd">                self.id.editingFinished.connect(lambda: self.update_return_dict(&#39;id&#39;, self.id.text()))</span>

<span class="sd">            Args:</span>
<span class="sd">                key (str): The key of the value being stored</span>
<span class="sd">                val: The value being stored.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>
            <span class="c1"># When values changed, update return dict</span>

<div class="viewcode-block" id="New_Subject_Wizard.Biography_Tab.calc_minmass"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.New_Subject_Wizard.Biography_Tab.calc_minmass">[docs]</a>        <span class="k">def</span> <span class="nf">calc_minmass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Calculates the minimum mass for a subject based on its baseline mass</span>
<span class="sd">            and the allowable percentage of that baseline</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># minimum mass automatically from % and baseline</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blmass</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">pct</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minmass_pct</span><span class="o">.</span><span class="n">text</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmass</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">baseline</span><span class="o">*</span><span class="n">pct</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="New_Subject_Wizard.Task_Tab"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.New_Subject_Wizard.Task_Tab">[docs]</a>    <span class="k">class</span> <span class="nc">Task_Tab</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A tab for selecting a task and step to assign to the subject.</span>

<span class="sd">        Reads available tasks from `prefs.PROTOCOLDIR` , lists them, and</span>
<span class="sd">        creates a spinbox to select from the available steps.</span>

<span class="sd">        Warning:</span>
<span class="sd">            Like :class:`.Biography_Tab` , these are not the actual instance attributes.</span>
<span class="sd">            Values are stored in a `values` dictionary.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            protocol (str): the name of the assigned protocol, filename without .json extension</span>
<span class="sd">            step (int): current step to assign.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">protocol_dir</span> <span class="o">=</span> <span class="n">prefs</span><span class="o">.</span><span class="n">PROTOCOLDIR</span>

            <span class="n">topLabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Protocols:&quot;</span><span class="p">)</span>

            <span class="c1"># List available protocols</span>
            <span class="n">protocol_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol_dir</span><span class="p">)</span>
            <span class="n">protocol_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">protocol_list</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">protocol_listbox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QListWidget</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">protocol_listbox</span><span class="o">.</span><span class="n">insertItems</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">protocol_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">protocol_listbox</span><span class="o">.</span><span class="n">currentItemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol_changed</span><span class="p">)</span>

            <span class="c1"># Make Step combobox</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_selection</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_selection</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_changed</span><span class="p">)</span>

            <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">topLabel</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol_listbox</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_selection</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

            <span class="c1"># Dict to return values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="New_Subject_Wizard.Task_Tab.update_step_box"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.New_Subject_Wizard.Task_Tab.update_step_box">[docs]</a>        <span class="k">def</span> <span class="nf">update_step_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Clears any steps that might be in the step selection box,</span>
<span class="sd">            loads the protocol file and repopulates it.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Clear box</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_selection</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step_selection</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Load the protocol and parse its steps</span>
            <span class="n">protocol_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol_listbox</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">protocol_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol_dir</span><span class="p">,</span><span class="n">protocol_str</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">protocol_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">protocol_file_open</span><span class="p">:</span>
                <span class="n">protocol</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">protocol_file_open</span><span class="p">)</span>

            <span class="n">step_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_ind</span>   <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">protocol</span><span class="p">):</span>
                <span class="n">step_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;step_name&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step_ind</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;step_name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">i</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">step_selection</span><span class="o">.</span><span class="n">insertItems</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">step_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_selection</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="New_Subject_Wizard.Task_Tab.protocol_changed"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.New_Subject_Wizard.Task_Tab.protocol_changed">[docs]</a>        <span class="k">def</span> <span class="nf">protocol_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            When the protocol is changed, save the value and call :py:meth:`.update_step_box`.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol_listbox</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_step_box</span><span class="p">()</span></div>

<div class="viewcode-block" id="New_Subject_Wizard.Task_Tab.step_changed"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.New_Subject_Wizard.Task_Tab.step_changed">[docs]</a>        <span class="k">def</span> <span class="nf">step_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            When the step is changed, save it.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">current_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_selection</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="c1"># Check that we have selected a step...</span>
            <span class="k">if</span> <span class="n">current_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_ind</span><span class="p">[</span><span class="n">current_step</span><span class="p">]</span></div></div></div>


<div class="viewcode-block" id="Protocol_Wizard"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard">[docs]</a><span class="k">class</span> <span class="nc">Protocol_Wizard</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dialog window to create a new protocol.</span>

<span class="sd">    Warning:</span>
<span class="sd">        This is a heavily overloaded class, and will be split into separate objects</span>
<span class="sd">        to handle parameters separately. For now this is what we got though and it works.</span>

<span class="sd">    Protocols are collections of multiple tasks (steps)</span>
<span class="sd">    with some graduation criterion for moving between them.</span>

<span class="sd">    This widget is composed of three windows:</span>

<span class="sd">    * **left**: possible task types from :py:data:`.tasks.TASK_LIST`</span>
<span class="sd">    * **center**: current steps in task</span>
<span class="sd">    * **right**: :class:`.Parameters` for currently selected step.</span>

<span class="sd">    The parameters that are used are of the form used by :py:attr:`.Task.PARAMS`</span>
<span class="sd">    (see :py:attr:`.Nafc.PARAMS` for an example).</span>

<span class="sd">    TODO:</span>
<span class="sd">        Make specific parameter class so this definition is less squishy</span>

<span class="sd">    its general structure is::</span>

<span class="sd">        {&#39;parameter_key&#39;: {&#39;tag&#39;:&#39;Human Readable Name&#39;,</span>
<span class="sd">                           &#39;type&#39;:&#39;param_type&#39;}}</span>

<span class="sd">    while some parameter types have extra items, eg.::</span>

<span class="sd">        {&#39;list_param&#39;: {&#39;tag&#39;:&#39;Select from a List of Parameters&#39;,</span>
<span class="sd">                        &#39;type&#39;: &#39;list&#39;,</span>
<span class="sd">                        &#39;values&#39;: {&#39;First Option&#39;:0, &#39;Second Option&#39;:1}}</span>

<span class="sd">    where k:v pairs are still used with lists to allow parameter values (0, 1) be human readable.</span>

<span class="sd">    The available types include:</span>

<span class="sd">    * **int** - integer</span>
<span class="sd">    * **bool** - boolean boolbox</span>
<span class="sd">    * **list** - a list of `values` to choose from</span>
<span class="sd">    * **sounds** - a :class:`.Sound_Widget` that allows sounds to be defined.</span>
<span class="sd">    * **graduation** - a :class:`.Graduation_Widget` that allows graduation criteria to be defined</span>

<span class="sd">    Attributes:</span>
<span class="sd">        task_list (:class:`QtGui.QListWidget`): The leftmost window, lists available tasks</span>
<span class="sd">        step_list (:class:`QtGui.QListWidget`): The center window, lists tasks currently in protocol</span>
<span class="sd">        param_layout (:class:`QtGui.QFormLayout`): The right window, allows changing available</span>
<span class="sd">            parameters for currently selected step.</span>
<span class="sd">        steps (list): A list of dictionaries defining the protocol.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Left Task List/Add Step Box</span>
        <span class="n">addstep_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Add Step&quot;</span><span class="p">)</span>
        <span class="n">addstep_label</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QListWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="o">.</span><span class="n">insertItems</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tasks</span><span class="o">.</span><span class="n">TASK_LIST</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_step</span><span class="p">)</span>

        <span class="n">addstep_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">addstep_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">addstep_label</span><span class="p">)</span>
        <span class="n">addstep_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">)</span>
        <span class="n">addstep_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">)</span>

        <span class="c1"># Center Step List Box</span>
        <span class="n">steplist_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Step List&quot;</span><span class="p">)</span>
        <span class="n">steplist_label</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QListWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">setDragDropMode</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">InternalMove</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">selectionMode</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SingleSelection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populate_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_model</span><span class="o">.</span><span class="n">rowsMoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reorder_steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_step_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_step_button</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_step_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_step</span><span class="p">)</span>

        <span class="n">steplist_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">steplist_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">steplist_label</span><span class="p">)</span>
        <span class="n">steplist_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="p">)</span>
        <span class="n">steplist_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_step_button</span><span class="p">)</span>

        <span class="c1"># Right Parameter Definition Window</span>
        <span class="n">param_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Step Parameters&quot;</span><span class="p">)</span>
        <span class="n">param_label</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFormLayout</span><span class="p">()</span>
        <span class="n">param_frame</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFrame</span><span class="p">()</span>
        <span class="n">param_frame</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="p">)</span>

        <span class="n">param_box_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">param_box_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">param_label</span><span class="p">)</span>
        <span class="n">param_box_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">param_frame</span><span class="p">)</span>

        <span class="c1"># Main Layout</span>
        <span class="n">frame_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">frame_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">addstep_layout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">frame_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">steplist_layout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">frame_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">param_box_layout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">buttonBox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="n">buttonBox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>

        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">frame_layout</span><span class="p">)</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">buttonBox</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">main_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Make New Protocol&quot;</span><span class="p">)</span>

        <span class="c1"># List to store dicts of steps and params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Protocol_Wizard.add_step"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard.add_step">[docs]</a>    <span class="k">def</span> <span class="nf">add_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads `PARAMS` from task object, adds base parameters to :py:attr:`.steps` list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">task_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">new_item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QListWidgetItem</span><span class="p">()</span>
        <span class="n">new_item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">task_type</span><span class="p">)</span>
        <span class="n">task_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">TASK_LIST</span><span class="p">[</span><span class="n">task_type</span><span class="p">]</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">)</span>

        <span class="c1"># Add params that are non-task specific</span>
        <span class="c1"># Name of task type</span>
        <span class="n">task_params</span><span class="p">[</span><span class="s1">&#39;task_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;label&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">task_type</span><span class="p">}</span>
        <span class="c1"># Prepend name of step shittily</span>
        <span class="n">task_params_temp</span> <span class="o">=</span> <span class="n">odict</span><span class="p">()</span>
        <span class="n">task_params_temp</span><span class="p">[</span><span class="s1">&#39;step_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">:</span><span class="s1">&#39;Step Name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">task_type</span><span class="p">}</span>
        <span class="n">task_params_temp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_params</span><span class="p">)</span>
        <span class="n">task_params</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">task_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_params_temp</span><span class="p">)</span>
        <span class="c1"># add graduation field</span>
        <span class="n">task_params</span><span class="p">[</span><span class="s1">&#39;graduation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;graduation&#39;</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">:</span><span class="s1">&#39;Graduation Criterion&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:{}}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span></div>

<div class="viewcode-block" id="Protocol_Wizard.rename_step"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard.rename_step">[docs]</a>    <span class="k">def</span> <span class="nf">rename_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the step name widget&#39;s text is changed,</span>
<span class="sd">        fire this function to update :py:attr:`.step_list` which updates</span>
<span class="sd">         :py:attr:`.steps`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="n">sender_text</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">current_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">currentRow</span><span class="p">())</span>
        <span class="n">current_step</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">sender_text</span><span class="p">)</span></div>

<div class="viewcode-block" id="Protocol_Wizard.remove_step"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard.remove_step">[docs]</a>    <span class="k">def</span> <span class="nf">remove_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove step from :py:attr:`.step_list` and :py:attr:`.steps`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">step_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">step_index</span><span class="p">)</span></div>

<div class="viewcode-block" id="Protocol_Wizard.populate_params"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard.populate_params">[docs]</a>    <span class="k">def</span> <span class="nf">populate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls :py:meth:`.clear_params` and then creates widgets to edit parameter values.</span>
<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># type: () -&gt; None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_params</span><span class="p">()</span>

        <span class="c1"># Get current item index</span>
        <span class="n">step_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="n">step_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step_index</span><span class="p">]</span>

        <span class="c1"># Iterate through params to make input widgets</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">step_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Make Input Widget depending on type</span>
            <span class="c1"># Each Input type needs a different widget type,</span>
            <span class="c1"># and each widget type has different methods to get/change values, so we have to do this ugly</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span> <span class="ow">or</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span>
                <span class="n">rowtag</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">])</span>
                <span class="n">input_widget</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
                <span class="n">input_widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
                    <span class="n">input_widget</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIntValidator</span><span class="p">())</span>
                <span class="n">input_widget</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_param</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">input_widget</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step_index</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">rowtag</span><span class="p">,</span><span class="n">input_widget</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bool&#39;</span><span class="p">:</span>
                <span class="n">rowtag</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">])</span>
                <span class="n">input_widget</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">()</span>
                <span class="n">input_widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">input_widget</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_param</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">input_widget</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step_index</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">rowtag</span><span class="p">,</span> <span class="n">input_widget</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
                <span class="n">rowtag</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">])</span>
                <span class="n">input_widget</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QListWidget</span><span class="p">()</span>
                <span class="n">input_widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">sorted_values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
                <span class="n">input_widget</span><span class="o">.</span><span class="n">insertItems</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sorted_values</span><span class="p">)</span>
                <span class="n">input_widget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_param</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">select_item</span> <span class="o">=</span> <span class="n">input_widget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    <span class="n">input_widget</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">select_item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step_index</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">rowtag</span><span class="p">,</span> <span class="n">input_widget</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step_index</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sounds&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sound_widget</span> <span class="o">=</span> <span class="n">Sound_Widget</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sound_widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sound_widget</span><span class="o">.</span><span class="n">pass_set_param_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_sounds</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sound_widget</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step_index</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;sounds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sound_widget</span><span class="o">.</span><span class="n">populate_lists</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;graduation&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grad_widget</span> <span class="o">=</span> <span class="n">Graduation_Widget</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grad_widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grad_widget</span><span class="o">.</span><span class="n">set_graduation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_graduation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grad_widget</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">combo_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_widget</span><span class="o">.</span><span class="n">type_selection</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grad_widget</span><span class="o">.</span><span class="n">type_selection</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">combo_index</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grad_widget</span><span class="o">.</span><span class="n">populate_params</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span>
                <span class="c1"># This is a .json label not for display</span>
                <span class="k">pass</span>

            <span class="c1"># Step name needs to be hooked up to the step list text</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;step_name&#39;</span><span class="p">:</span>
                <span class="n">input_widget</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rename_step</span><span class="p">)</span></div>

        <span class="c1"># TODO: Implement dependencies between parameters</span>

<div class="viewcode-block" id="Protocol_Wizard.clear_params"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard.clear_params">[docs]</a>    <span class="k">def</span> <span class="nf">clear_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears widgets from parameter window</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">widget</span><span class="p">():</span>
                <span class="n">child</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span></div>

<div class="viewcode-block" id="Protocol_Wizard.reorder_steps"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard.reorder_steps">[docs]</a>    <span class="k">def</span> <span class="nf">reorder_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When steps are dragged into a different order, update the step dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Input from our :py:attr:`.step_list` &#39;s :class:`.QtGui.QListModel` &#39;s reorder signal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># arg positions 1 and 4 are starting and ending positions in the list, respectively</span>
        <span class="c1"># We reorder our step list so the params line up.</span>
        <span class="n">before</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">after</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">after</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">before</span><span class="p">))</span></div>

<div class="viewcode-block" id="Protocol_Wizard.set_param"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard.set_param">[docs]</a>    <span class="k">def</span> <span class="nf">set_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback function connected to the signal each widget uses to signal it has changed.</span>

<span class="sd">        Identifies the param that was changed, gets the current value, and updates `self.steps`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="n">param_name</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>
        <span class="n">current_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="n">sender_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">current_step</span><span class="p">][</span><span class="n">param_name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">sender_type</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span> <span class="ow">or</span> <span class="n">sender_type</span> <span class="o">==</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">current_step</span><span class="p">][</span><span class="n">param_name</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sender_type</span> <span class="o">==</span> <span class="s1">&#39;bool&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">current_step</span><span class="p">][</span><span class="n">param_name</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sender_type</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="n">list_text</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">list_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">current_step</span><span class="p">][</span><span class="n">param_name</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="n">list_text</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">current_step</span><span class="p">][</span><span class="n">param_name</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_value</span>
        <span class="k">elif</span> <span class="n">sender_type</span> <span class="o">==</span> <span class="s1">&#39;sounds&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">current_step</span><span class="p">][</span><span class="n">param_name</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sound_widget</span><span class="o">.</span><span class="n">sound_dict</span></div>

<div class="viewcode-block" id="Protocol_Wizard.set_sounds"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard.set_sounds">[docs]</a>    <span class="k">def</span> <span class="nf">set_sounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores parameters that define sounds.</span>

<span class="sd">        Sound parameters work a bit differently, specifically we have to retrieve</span>
<span class="sd">        :py:attr:`.Sound_Widget.sound_dict`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="c1">#if &#39;sounds&#39; in self.steps[current_step][&#39;stim&#39;].keys():</span>
        <span class="c1">#    self.steps[current_step][param_name][&#39;sounds&#39;][&#39;value&#39;].update(self.sound_widget.sound_dict)</span>
        <span class="c1">#else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">current_step</span><span class="p">][</span><span class="s1">&#39;stim&#39;</span><span class="p">][</span><span class="s1">&#39;sounds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sound_widget</span><span class="o">.</span><span class="n">sound_dict</span></div>

<div class="viewcode-block" id="Protocol_Wizard.set_graduation"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard.set_graduation">[docs]</a>    <span class="k">def</span> <span class="nf">set_graduation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores parameters that define graduation criteria in `self.steps`</span>

<span class="sd">        Graduation parameters work a bit differently, specifically we have to retrieve</span>
<span class="sd">        :py:attr:`.Graduation_Widget.param_dict`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_list</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="n">grad_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_widget</span><span class="o">.</span><span class="n">type</span>
        <span class="n">grad_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_widget</span><span class="o">.</span><span class="n">param_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">current_step</span><span class="p">][</span><span class="s1">&#39;graduation&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">grad_type</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">grad_params</span><span class="p">}</span></div>


<div class="viewcode-block" id="Protocol_Wizard.check_depends"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Protocol_Wizard.check_depends">[docs]</a>    <span class="k">def</span> <span class="nf">check_depends</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle dependencies between parameters, eg. if &quot;correction trials&quot; are unchecked,</span>
<span class="sd">        the box that defines the correction trial percentage should be grayed out.</span>

<span class="sd">        TODO:</span>
<span class="sd">            Not implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Make dependent fields unavailable if dependencies unmet</span>
        <span class="c1"># I mean if it really matters</span>
        <span class="k">pass</span></div></div>

<div class="viewcode-block" id="Graduation_Widget"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Graduation_Widget">[docs]</a><span class="k">class</span> <span class="nc">Graduation_Widget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A widget used in :class:`.Protocol_Wizard` to define graduation parameters.</span>

<span class="sd">    See :py:mod:`.tasks.graduation` .</span>

<span class="sd">    A protocol is composed of multiple tasks (steps), and graduation criteria</span>
<span class="sd">    define when a subject should progress through those steps.</span>

<span class="sd">    eg. a subject should graduate one stage after 300 trials, or after it reaches</span>
<span class="sd">    75% accuracy over the last 500 trials.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        type_selection (:class:`QtGui.QComboBox`): A box to select from the available</span>
<span class="sd">            graduation types listed in :py:data:`.tasks.GRAD_LIST` . Has its `currentIndexChanged`</span>
<span class="sd">            signal connected to :py:meth:`.Graduation_Widget.populate_params`</span>
<span class="sd">        param_dict (dict): Stores the type of graduation and the relevant params,</span>
<span class="sd">            fetched by :class:`.Protocol_Wizard` when defining a protocol.</span>
<span class="sd">        set_graduation (:py:meth:`.Protocol_Wizard.set_graduation`): Passed to us after we&#39;re inited.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Graduation_Widget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Grad type dropdown</span>
        <span class="n">type_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Graduation Criterion:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_selection</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_selection</span><span class="o">.</span><span class="n">insertItems</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tasks</span><span class="o">.</span><span class="n">GRAD_LIST</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_selection</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populate_params</span><span class="p">)</span>

        <span class="c1"># Param form</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFormLayout</span><span class="p">()</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">type_label</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_selection</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_graduation</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">populate_params</span><span class="p">()</span>

<div class="viewcode-block" id="Graduation_Widget.populate_params"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Graduation_Widget.populate_params">[docs]</a>    <span class="k">def</span> <span class="nf">populate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repopulate the widget with fields to edit graduation parameters, fill fields</span>
<span class="sd">        if we are passed `params`.</span>

<span class="sd">        Each :class:`QtGui.QLineEdit` &#39;s :py:meth:`.QLineEdit.editingFinished` signal is connected</span>
<span class="sd">        to :py:meth:`.Graduation_Widget.store_param` .</span>

<span class="sd">        TODO:</span>
<span class="sd">            For now we assume all parameters are defined with a text edit box, so it&#39;s not</span>
<span class="sd">            clear how we&#39;d do boolean parameters for example. This will be fixed with refactoring</span>
<span class="sd">            the parameter scheme, the first order of business for v0.3.</span>

<span class="sd">        Args:</span>
<span class="sd">            params (dict): In the case that :class:`.Protocol_Wizard` switches us back to</span>
<span class="sd">                a step where we have already defined graduation parameters, it will pass them</span>
<span class="sd">                so we can repopulate the relevant widgets with them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_params</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_selection</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tasks</span><span class="o">.</span><span class="n">GRAD_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">:</span>
            <span class="n">edit_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
            <span class="n">edit_box</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">edit_box</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_param</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">edit_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">edit_box</span><span class="p">)</span></div>

<div class="viewcode-block" id="Graduation_Widget.clear_params"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Graduation_Widget.clear_params">[docs]</a>    <span class="k">def</span> <span class="nf">clear_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear any parameter widgets we have.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">widget</span><span class="p">():</span>
                <span class="n">child</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span></div>

<div class="viewcode-block" id="Graduation_Widget.store_param"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Graduation_Widget.store_param">[docs]</a>    <span class="k">def</span> <span class="nf">store_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When a parameter is edited, save it in our param_dict, and also call our</span>
<span class="sd">        `set_graduation` method, which should be :py:meth:`.Protocol_Wizard.set_graduation`</span>
<span class="sd">        passed to us after instantiation.</span>

<span class="sd">        If we were not passed `set_graduation`, just saves in `param_dict`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_graduation</span><span class="p">):</span>
            <span class="ne">Warning</span><span class="p">(</span><span class="s2">&quot;Stored Graduation parameters in our param_dict, but wasn&#39;t passed a set_graduation method!&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_graduation</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="Drag_List"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Drag_List">[docs]</a><span class="k">class</span> <span class="nc">Drag_List</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QListWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A :class:`QtGui.QListWidget` that is capable of having files dragged &amp; dropped.</span>

<span class="sd">    copied with much gratitude from `stackoverflow &lt;https://stackoverflow.com/a/25614674&gt;`_</span>

<span class="sd">    Primarily used in :class:`.Sound_Widget` to be able to drop sound files.</span>

<span class="sd">    To use: connect `fileDropped` to a method, that method will receive a list of files</span>
<span class="sd">    dragged onto this widget.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        fileDropped (:class:`QtCore.Signal`): A Qt signal that takes a list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fileDropped</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># type: () -&gt; None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Drag_List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAcceptDrops</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<div class="viewcode-block" id="Drag_List.dragEnterEvent"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Drag_List.dragEnterEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dragEnterEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When files are dragged over us, if they have paths in them,</span>
<span class="sd">        accept the event.</span>

<span class="sd">        Args:</span>
<span class="sd">            e (:class:`QtCore.QEvent`): containing the drag information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">hasUrls</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span></div>

<div class="viewcode-block" id="Drag_List.dragMoveEvent"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Drag_List.dragMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dragMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the `dragEnterEvent` was accepted, while the drag is being moved within us,</span>
<span class="sd">        `setDropAction` to :class:`.QtCore.Qt.CopyAction`</span>

<span class="sd">        Args:</span>
<span class="sd">            event (:class:`QtCore.QEvent`): containing the drag information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">hasUrls</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">setDropAction</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CopyAction</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span></div>

<div class="viewcode-block" id="Drag_List.dropEvent"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Drag_List.dropEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dropEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the files are finally dropped, if they contain paths,</span>
<span class="sd">        emit the list of paths through the `fileDropped` signal.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (:class:`QtCore.QEvent`): containing the drag information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">hasUrls</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">setDropAction</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CopyAction</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">urls</span><span class="p">():</span>
                <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">toLocalFile</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileDropped</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Sound_Widget"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Sound_Widget">[docs]</a><span class="k">class</span> <span class="nc">Sound_Widget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A widget that allows sounds to be parameterized.</span>

<span class="sd">    Used in :class:`.Protocol_Wizard` .</span>

<span class="sd">    Has two :class:`.Drag_List` s for left and right sounds (for a 2afc task), given</span>
<span class="sd">    Buttons beneath them allow adding and removing sounds.</span>

<span class="sd">    Adding a sound will open a :class:`.Add_SoundDialog`</span>

<span class="sd">    TODO:</span>
<span class="sd">        Sounds will eventually be more elegantly managed by a ... sound manager..</span>
<span class="sd">        For now sound managers are rudimentary and only support random presentation</span>
<span class="sd">        with correction trials and bias correction.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        sound_dict (dict): Dictionary with the structure::</span>

<span class="sd">                {&#39;L&#39;: [{&#39;param_1&#39;:&#39;param_1&#39;, ... }], &#39;R&#39;: [...]}</span>

<span class="sd">            where multiple sounds can be present in either &#39;L&#39; or &#39;R&#39; list.</span>



<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># type: () -&gt; None</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span> <span class="o">=</span> <span class="n">prefs</span><span class="o">.</span><span class="n">SOUNDDIR</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_sounds</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># Left sounds</span>
        <span class="n">left_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Left Sounds&quot;</span><span class="p">)</span>
        <span class="n">left_label</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_list</span> <span class="o">=</span> <span class="n">Drag_List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_list</span><span class="o">.</span><span class="n">fileDropped</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files_dropped</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_list</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_left_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_left_button</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_left_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_sound</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_left_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_left_button</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_left_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_sound</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">))</span>

        <span class="n">left_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">left_button_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">left_button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_left_button</span><span class="p">)</span>
        <span class="n">left_button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_left_button</span><span class="p">)</span>
        <span class="n">left_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">left_label</span><span class="p">)</span>
        <span class="n">left_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_list</span><span class="p">)</span>
        <span class="n">left_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">left_button_layout</span><span class="p">)</span>

        <span class="c1"># Right sounds</span>
        <span class="n">right_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Right Sounds&quot;</span><span class="p">)</span>
        <span class="n">right_label</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_list</span> <span class="o">=</span> <span class="n">Drag_List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_list</span><span class="o">.</span><span class="n">fileDropped</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files_dropped</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_list</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_right_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_right_button</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_right_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_sound</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_right_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_right_button</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_right_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_sound</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">))</span>

        <span class="n">right_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">right_button_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">right_button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_right_button</span><span class="p">)</span>
        <span class="n">right_button_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_right_button</span><span class="p">)</span>
        <span class="n">right_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">right_label</span><span class="p">)</span>
        <span class="n">right_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_list</span><span class="p">)</span>
        <span class="n">right_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">right_button_layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sound_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">left_layout</span><span class="p">)</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">right_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">main_layout</span><span class="p">)</span>

        <span class="c1"># TODO:Add drag and drop for files</span>

<div class="viewcode-block" id="Sound_Widget.pass_set_param_function"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Sound_Widget.pass_set_param_function">[docs]</a>    <span class="k">def</span> <span class="nf">pass_set_param_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_param_fnxn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Receives :py:meth:`.Protocol_Wizard.set_sounds`</span>

<span class="sd">        Args:</span>
<span class="sd">            set_param_fnxn (:py:meth:`.Protocol_Wizard.set_sounds`): Called when sounds are changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_sounds</span> <span class="o">=</span> <span class="n">set_param_fnxn</span></div>

<div class="viewcode-block" id="Sound_Widget.add_sound"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Sound_Widget.add_sound">[docs]</a>    <span class="k">def</span> <span class="nf">add_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the &quot;+&quot; button on either side is pressed, open an :class:`.Add_Sound_Dialog`.</span>

<span class="sd">        Args:</span>
<span class="sd">            side (str): The buttons are connected with a lambda function, this will be either &#39;L&#39; or &#39;R&#39;.</span>
<span class="sd">                Used to add sounds to the `sound_dict`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_sound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Add_Sound_Dialog</span><span class="p">()</span>
        <span class="n">new_sound</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">new_sound</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sound_dict</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_sound</span><span class="o">.</span><span class="n">param_dict</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">left_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">new_sound</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">right_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">new_sound</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_sounds</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sound_Widget.remove_sound"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Sound_Widget.remove_sound">[docs]</a>    <span class="k">def</span> <span class="nf">remove_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the &quot;-&quot; button is pressed, remove the currently highlighted sound.</span>

<span class="sd">        Args:</span>
<span class="sd">            side (str): The buttons are connected with a lambda function, this will be either &#39;L&#39; or &#39;R&#39;.</span>
<span class="sd">                Selects that list so we can remove the currently selected row.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
            <span class="n">current_sound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_list</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sound_dict</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">current_sound</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_list</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">current_sound</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
            <span class="n">current_sound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_list</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sound_dict</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">current_sound</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_list</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">current_sound</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_sounds</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sound_Widget.populate_lists"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Sound_Widget.populate_lists">[docs]</a>    <span class="k">def</span> <span class="nf">populate_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sound_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the sound lists after re-selecting a step.</span>

<span class="sd">        Args:</span>
<span class="sd">            sound_dict (dict): passed to us by :class:`.Protocol_Wizard` upon reselecting a step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Populate the sound lists after re-selecting a step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sound_dict</span> <span class="o">=</span> <span class="n">sound_dict</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sound_dict</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sound_dict</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Sound_Widget.files_dropped"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Sound_Widget.files_dropped">[docs]</a>    <span class="k">def</span> <span class="nf">files_dropped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Warning:</span>
<span class="sd">            This was programmed hastily and is pretty idiosyncratic to my use.</span>

<span class="sd">            It does work for general files but has some extra logic built in to handle my stimuli.</span>

<span class="sd">            To be made more general in v0.3</span>

<span class="sd">        Note:</span>
<span class="sd">            Sounds must be in the folder specified in `prefs.SOUNDDIR`.</span>

<span class="sd">        When files are dropped on the lists, strips `prefs.SOUNDDIR` from them to make them</span>
<span class="sd">        relative paths, adds them to the `sound_dict`</span>

<span class="sd">        Args:</span>
<span class="sd">            files (list): List of absolute paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Make this more general...</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Are these Speech sounds in the format &#39;/speaker/cv/cv_#.wav&#39;?&quot;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sound_dict</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;File&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span><span class="n">f</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">left_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">right_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


        <span class="k">elif</span> <span class="n">ret</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sounddir</span><span class="p">)</span>
                <span class="n">f_split</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="n">speaker</span> <span class="o">=</span> <span class="n">f_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cv</span> <span class="o">=</span> <span class="n">f_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">consonant</span> <span class="o">=</span> <span class="n">cv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vowel</span> <span class="o">=</span> <span class="n">cv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">f_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Speech&#39;</span><span class="p">,</span><span class="s1">&#39;path&#39;</span><span class="p">:</span><span class="n">f</span><span class="p">,</span>
                 <span class="s1">&#39;speaker&#39;</span><span class="p">:</span><span class="n">speaker</span><span class="p">,</span><span class="s1">&#39;consonant&#39;</span><span class="p">:</span><span class="n">consonant</span><span class="p">,</span>
                 <span class="s1">&#39;vowel&#39;</span><span class="p">:</span><span class="n">vowel</span><span class="p">,</span><span class="s1">&#39;token&#39;</span><span class="p">:</span><span class="n">token</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sound_dict</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">left_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">right_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_sounds</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sound_Widget.Add_Sound_Dialog"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Sound_Widget.Add_Sound_Dialog">[docs]</a>    <span class="k">class</span> <span class="nc">Add_Sound_Dialog</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Presents a dialog to define a new sound.</span>

<span class="sd">        Makes a selection box to choose the sound type from</span>
<span class="sd">        :py:data:`.sounds.SOUND_LIST` , and then populates edit boxes</span>
<span class="sd">        so we can fill in its `PARAMS` .</span>

<span class="sd">        Attributes:</span>
<span class="sd">            type_selection (:class:`QtGui.QComboBox`): Select from a list of available sounds</span>
<span class="sd">            param_dict (dict): Parameters that are retreived by the calling :class:`.Sound_Widget`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># type: () -&gt; None</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Sound type dropdown</span>
            <span class="n">type_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Sound Type:&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type_selection</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type_selection</span><span class="o">.</span><span class="n">insertItems</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sounds</span><span class="o">.</span><span class="n">SOUND_LIST</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type_selection</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populate_params</span><span class="p">)</span>

            <span class="c1"># Param form</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFormLayout</span><span class="p">()</span>

            <span class="c1"># Button box</span>
            <span class="n">buttonBox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
            <span class="n">buttonBox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>

            <span class="c1"># Layout</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">type_label</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_selection</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">buttonBox</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

            <span class="c1"># dict for storing params</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_dict</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Sound_Widget.Add_Sound_Dialog.populate_params"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Sound_Widget.Add_Sound_Dialog.populate_params">[docs]</a>        <span class="k">def</span> <span class="nf">populate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            When a sound type is selected, make a :class:`.QtGui.QLineEdit` for each</span>
<span class="sd">            `PARAM` in its definition.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_params</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_selection</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sounds</span><span class="o">.</span><span class="n">SOUND_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">:</span>
                <span class="n">edit_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
                <span class="n">edit_box</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">edit_box</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_param</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">edit_box</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sound_Widget.Add_Sound_Dialog.clear_params"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Sound_Widget.Add_Sound_Dialog.clear_params">[docs]</a>        <span class="k">def</span> <span class="nf">clear_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Clear all current widgets</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
                <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">widget</span><span class="p">():</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sound_Widget.Add_Sound_Dialog.store_param"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Sound_Widget.Add_Sound_Dialog.store_param">[docs]</a>        <span class="k">def</span> <span class="nf">store_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            When one of our edit boxes is edited, stash the parameter in `param_dict`</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># type: () -&gt; None</span>
            <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span><span class="p">()</span></div></div></div>

<span class="c1">###################################3</span>
<span class="c1"># Tools</span>
<span class="c1">######################################</span>

<div class="viewcode-block" id="Bandwidth_Test"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Bandwidth_Test">[docs]</a><span class="k">class</span> <span class="nc">Bandwidth_Test</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the limits of the rate of messaging from the connected Pilots.</span>

<span class="sd">    Asks pilots to send messages at varying rates and with varying payload sizes, and with messages with/without receipts.</span>

<span class="sd">    Measures drop rates and message latency</span>

<span class="sd">    Attributes:</span>
<span class="sd">        rate_list (list): List of rates (Hz) to test</span>
<span class="sd">        payload_list (list): List of payload sizes (KB) to test</span>
<span class="sd">        messages (list): list of messages received during test</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pilots</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Bandwidth_Test</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span> <span class="o">=</span> <span class="n">pilots</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rate_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payload_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_pilots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished_pilots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span><span class="p">[]</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">end_test</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_test</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">listens</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;BANDWIDTH_MSG&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_msg</span>
        <span class="p">}</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">Net_Node</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">,</span>
                             <span class="n">upstream</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span>
                             <span class="n">port</span> <span class="o">=</span> <span class="n">prefs</span><span class="o">.</span><span class="n">MSGPORT</span><span class="p">,</span>
                             <span class="n">listens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">listens</span><span class="p">,</span>
                             <span class="n">do_logging</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

<div class="viewcode-block" id="Bandwidth_Test.init_ui"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Bandwidth_Test.init_ui">[docs]</a>    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Look we&#39;re just making the stuff in the window over here alright? relax.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># two panes: left selects the pilots and sets params of the test,</span>
        <span class="c1"># right plots outcomes</span>

        <span class="c1"># main layout l/r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>

        <span class="c1"># left layout for settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFormLayout</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_messages</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;1000&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_messages</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIntValidator</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">receipts</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Get receipts?&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receipts</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;50&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s1">&#39;rates&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">payloads</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payloads</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s1">&#39;payloads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payloads</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payload_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># checkboxes for which pis to include in test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pilot_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Pilots&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pilot_checks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pilot_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pilot_checks</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pilot_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>

        <span class="c1"># gotta have progress bars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_pbar</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QProgressBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_pbar</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QProgressBar</span><span class="p">()</span>

        <span class="c1"># buttons to start test/save results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_btn</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Start Test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_btn</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Save Results&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">)</span>


        <span class="c1"># combine settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;N messages per test&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_messages</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Confirm sent messages?&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">receipts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Message Rates per Pilot </span><span class="se">\n</span><span class="s1">(in Hz, list of integers like &quot;1, 2, 3&quot;)&#39;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Payload sizes per message </span><span class="se">\n</span><span class="s1">(in KB, list of integers like &quot;32, 64, 128&quot;)&#39;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">payloads</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Which Pilots to include in test&#39;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">pilot_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Progress: All tests&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_pbar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s1">&#39;Progress: This test&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_pbar</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_btn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_btn</span><span class="p">)</span>

        <span class="c1">###########</span>
        <span class="c1"># plotting widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_plot</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">PlotWidget</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Message Drop Rate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay_plot</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">PlotWidget</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Mean Delay&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_plot</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">PlotWidget</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Requested vs. Actual speed&#39;</span><span class="p">)</span>


        <span class="c1"># the actual graphical objects that draw stuff for us</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">symbolBrush</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_line</span><span class="o">.</span><span class="n">setPen</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay_line</span><span class="o">.</span><span class="n">setPen</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_line</span><span class="o">.</span><span class="n">setPen</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">plot_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drop_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_plot</span><span class="p">)</span>



        <span class="c1"># add panes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_layout</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bandwidth_Test.start"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Bandwidth_Test.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the test!!!</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># lists to store our results for plotting and etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span><span class="p">[]</span>

        <span class="c1"># first make sure we got everything we need</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warning_msg</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">,</span>
                                            <span class="s2">&quot;No rates to test!&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;Couldn&#39;t find a list of rates to test, did you enter one?&quot;</span><span class="p">)</span>
            <span class="n">warning_msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload_list</span><span class="p">)</span> <span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
            <span class="n">warning_msg</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">,</span>
                                            <span class="s2">&quot;No payloads to test!&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;Couldn&#39;t find a list of payloads to test, did you enter one?&quot;</span><span class="p">)</span>
            <span class="n">warning_msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># get list of checked pis</span>
        <span class="n">test_pilots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pilot</span><span class="p">,</span> <span class="n">p_box</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pilot_checks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">p_box</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">test_pilots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pilot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_pilots</span> <span class="o">=</span> <span class="n">test_pilots</span>


        <span class="c1"># stash some run parameters</span>
        <span class="n">get_receipts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">receipts</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">n_messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_messages</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="c1"># &#39;n messages for this test&#39; in case user changes it during run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_messages_test</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_messages</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">save_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="c1"># set pbars</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">payload_len</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">payload_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_pbar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_list</span><span class="p">)</span><span class="o">*</span><span class="n">payload_len</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_pbar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_messages_test</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">test_pilots</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_pbar</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="c1"># save tests to do, disable play button, and get to doing it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests_todo</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">payload_list</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_messages_test</span><span class="p">],</span> <span class="p">[</span><span class="n">get_receipts</span><span class="p">])]</span>




        <span class="c1"># used to update pbar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_counter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">current_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tests_todo</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_test</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">current_test</span><span class="p">)</span></div>
        <span class="c1"># # start a timer that continues the test if messages are dropped</span>
        <span class="c1"># try:</span>
        <span class="c1">#     self.repeat_timer.cancel()</span>
        <span class="c1"># except:</span>
        <span class="c1">#     pass</span>
        <span class="c1">#</span>
        <span class="c1"># self.repeat_timer = threading.Timer(self.current_test[0] * self.current_test[2] * 20,</span>
        <span class="c1">#                                     self.process_test, args=self.current_test)</span>
        <span class="c1"># self.repeat_timer.daemon = True</span>
        <span class="c1"># self.repeat_timer.start()</span>



<div class="viewcode-block" id="Bandwidth_Test.send_test"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Bandwidth_Test.send_test">[docs]</a>    <span class="k">def</span> <span class="nf">send_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">n_msg</span><span class="p">,</span> <span class="n">confirm</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished_pilots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>


        <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="n">rate</span><span class="p">,</span>
               <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
               <span class="s1">&#39;n_msg&#39;</span><span class="p">:</span> <span class="n">n_msg</span><span class="p">,</span>
               <span class="s1">&#39;confirm&#39;</span><span class="p">:</span> <span class="n">confirm</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_test</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_pbar</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_counter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_pilots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;BANDWIDTH&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bandwidth_Test.process_test"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Bandwidth_Test.process_test">[docs]</a>    <span class="nd">@gui_event</span>
    <span class="k">def</span> <span class="nf">process_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">n_msg</span><span class="p">,</span> <span class="n">confirm</span><span class="p">):</span>

        <span class="c1"># start a timer that continues the test if messages are dropped</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repeat_timer</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># process messages</span>
        <span class="n">msg_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span>
                                           <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pilot&#39;</span><span class="p">,</span> <span class="s1">&#39;n_msg&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp_sent&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp_rcvd&#39;</span><span class="p">,</span> <span class="s1">&#39;payload_size&#39;</span><span class="p">,</span> <span class="s1">&#39;message_size&#39;</span><span class="p">])</span>
        <span class="n">msg_df</span> <span class="o">=</span> <span class="n">msg_df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;timestamp_sent&#39;</span><span class="p">:</span><span class="s1">&#39;datetime64&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp_rcvd&#39;</span><span class="p">:</span><span class="s1">&#39;datetime64&#39;</span><span class="p">})</span>

        <span class="c1"># compute summary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mean_delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">msg_df</span><span class="p">[</span><span class="s1">&#39;timestamp_rcvd&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">msg_df</span><span class="p">[</span><span class="s1">&#39;timestamp_sent&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">mean_delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">msg_df</span><span class="p">[</span><span class="s1">&#39;timestamp_rcvd&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">msg_df</span><span class="p">[</span><span class="s1">&#39;timestamp_sent&#39;</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">send_jitter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">msg_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pilot&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp_sent</span><span class="o">.</span><span class="n">diff</span><span class="p">())</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">msg_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pilot&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp_sent</span><span class="o">.</span><span class="n">diff</span><span class="p">()))</span>
            <span class="n">send_jitter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">msg_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pilot&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp_sent</span><span class="o">.</span><span class="n">diff</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">delay_jitter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">msg_df</span><span class="p">[</span><span class="s1">&#39;timestamp_rcvd&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">msg_df</span><span class="p">[</span><span class="s1">&#39;timestamp_sent&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">delay_jitter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">msg_df</span><span class="p">[</span><span class="s1">&#39;timestamp_rcvd&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">msg_df</span><span class="p">[</span><span class="s1">&#39;timestamp_sent&#39;</span><span class="p">])</span>

        <span class="n">drop_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="p">(</span><span class="n">msg_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pilot&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">n_msg</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_msg</span><span class="p">)))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">mean_speed</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">msg_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pilot&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp_rcvd</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">mean_speed</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">msg_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pilot&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp_rcvd</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">mean_payload</span> <span class="o">=</span> <span class="n">msg_df</span><span class="o">.</span><span class="n">payload_size</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">mean_message</span> <span class="o">=</span> <span class="n">msg_df</span><span class="o">.</span><span class="n">message_size</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1">#print(msg_df.groupby(&#39;pilot&#39;).timestamp_rcvd.diff())</span>

        <span class="c1"># plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drop_rate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_delay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_speed</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rate</span><span class="p">,</span> <span class="n">mean_payload</span><span class="p">,</span> <span class="n">mean_message</span><span class="p">,</span> <span class="n">n_msg</span><span class="p">,</span> <span class="n">confirm</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_pilots</span><span class="p">),</span> <span class="n">mean_delay</span><span class="p">,</span> <span class="n">drop_rate</span><span class="p">,</span> <span class="n">mean_speed</span><span class="p">,</span> <span class="n">send_jitter</span><span class="p">,</span> <span class="n">delay_jitter</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delay_line</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_line</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">drops</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_line</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speeds</span><span class="p">)</span>
        <span class="c1"># self.drop_plot.setYRange(np.min(self.drops), np.max(self.drops),</span>
        <span class="c1">#                          padding=(np.max(self.drops) - np.min(self.drops)) * .1)</span>
        <span class="c1"># self.delay_plot.setYRange(np.min(self.delays), np.max(self.delays),</span>
        <span class="c1">#                           padding=(np.max(self.delays) - np.min(self.delays)) * .1)</span>
        <span class="c1"># self.speed_plot.setYRange(np.min(self.speeds), np.max(self.speeds))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">all_pbar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_counter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>



        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tests_todo</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tests_todo</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_test</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">current_test</span><span class="p">)</span>

            <span class="c1"># self.repeat_timer = threading.Timer(self.current_test[0]*self.current_test[2]*10,</span>
            <span class="c1">#                                     self.process_test, args=self.current_test)</span>
            <span class="c1"># self.repeat_timer.daemon = True</span>
            <span class="c1"># self.repeat_timer.start()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repaint</span><span class="p">()</span></div>



<div class="viewcode-block" id="Bandwidth_Test.save"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Bandwidth_Test.save">[docs]</a>    <span class="nd">@gui_event</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select save file location for test results (csv) and then save them there</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fileName</span><span class="p">,</span> <span class="n">filtr</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="s2">&quot;Where should we save these results?&quot;</span><span class="p">,</span>
                <span class="n">prefs</span><span class="o">.</span><span class="n">DATADIR</span><span class="p">,</span>
                <span class="s2">&quot;CSV files (*.csv)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># make and save results df</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span>
                                               <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="s1">&#39;payload_size&#39;</span><span class="p">,</span> <span class="s1">&#39;message_size&#39;</span><span class="p">,</span> <span class="s1">&#39;n_messages&#39;</span><span class="p">,</span> <span class="s1">&#39;confirm&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;n_pilots&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_delay&#39;</span><span class="p">,</span> <span class="s1">&#39;drop_rate&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;actual_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;send_jitter&#39;</span><span class="p">,</span> <span class="s1">&#39;delay_jitter&#39;</span><span class="p">])</span>

            <span class="n">res_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                  <span class="s2">&quot;Results saved!&quot;</span><span class="p">,</span> <span class="s2">&quot;Results saved to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Error saving&quot;</span><span class="p">,</span>
                                               <span class="s2">&quot;Error while saving your results:</span><span class="se">\n</span><span class="s2">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>




<div class="viewcode-block" id="Bandwidth_Test.register_msg"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Bandwidth_Test.register_msg">[docs]</a>    <span class="k">def</span> <span class="nf">register_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Receive message from pilot, stash timestamp, number and pilot</span>


<span class="sd">        Args:</span>
<span class="sd">            value (dict): Value should contain</span>

<span class="sd">                * Pilot</span>
<span class="sd">                * Timestamp</span>
<span class="sd">                * Message number</span>
<span class="sd">                * Payload</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># have to iterate over contents to get true size,</span>
        <span class="c1"># and then add size of container itself.</span>
        <span class="c1"># payload size is distinct from the serialized message size, this is the end size</span>
        <span class="c1"># as it ends up on the disk of the receiver</span>
        <span class="n">payload_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


        <span class="k">if</span> <span class="s1">&#39;test_end&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished_pilots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;pilot&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finished_pilots</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_pilots</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_test</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;n_msg&#39;</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;confirm&#39;</span><span class="p">])</span>

            <span class="k">return</span>


        <span class="c1">#payload_size = np.frombuffer(base64.b64decode(value[&#39;payload&#39;]),dtype=np.bool).nbytes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;pilot&#39;</span><span class="p">],</span>
                              <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;n_msg&#39;</span><span class="p">]),</span>
                              <span class="n">value</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
                              <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                              <span class="n">payload_size</span><span class="p">,</span>
                              <span class="n">value</span><span class="p">[</span><span class="s1">&#39;message_size&#39;</span><span class="p">]))</span>

        <span class="n">msgs_rcvd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_counter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">msgs_rcvd</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_messages_test</span><span class="o">/</span><span class="mf">100.0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">update_pbar</span><span class="p">(</span><span class="n">msgs_rcvd</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>



<div class="viewcode-block" id="Bandwidth_Test.update_pbar"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Bandwidth_Test.update_pbar">[docs]</a>    <span class="nd">@gui_event</span>
    <span class="k">def</span> <span class="nf">update_pbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_pbar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>



<div class="viewcode-block" id="Bandwidth_Test.validate_list"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Bandwidth_Test.validate_list">[docs]</a>    <span class="k">def</span> <span class="nf">validate_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks that the entries in :py:attr:`Bandwidth_Test.rates` and :py:attr:`Bandwidth_Test.payloads` are well formed.</span>

<span class="sd">        ie. that they are of the form &#39;integer, integer, integer&#39;...</span>

<span class="sd">        pops a window that warns about ill formed entry and clears line edit if badly formed</span>

<span class="sd">        If the list validates, stored as either :py:attr:`Bandwidth_Test.rate_list` or :py:attr:`Bandwidth_Test.payload_list`</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># user doesn&#39;t have to add open/close brackets in input, make sure</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;[ &#39;</span> <span class="o">+</span> <span class="n">text</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; ]&#39;</span>

        <span class="c1"># validate form of string</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">a_list</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="n">warning_msg</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">,</span>
                                            <span class="s2">&quot;Improperly formatted list!&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;The input received wasn&#39;t a properly formatted list of integers. Make sure your input is of the form &#39;1, 2, 3&#39; or &#39;[ 1, 2, 3 ]&#39;</span><span class="se">\n</span><span class="s2">instead got : {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
            <span class="n">sender</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">warning_msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

            <span class="k">return</span>

        <span class="c1"># validate integers</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">warning_msg</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">,</span>
                                                <span class="s2">&quot;Improperly formatted list!&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;The input received wasn&#39;t a properly formatted list of integers. Make sure your input is of the form &#39;1, 2, 3&#39; or &#39;[ 1, 2, 3 ]&#39;</span><span class="se">\n</span><span class="s2">instead got : {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                    <span class="n">text</span><span class="p">))</span>
                <span class="n">sender</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">warning_msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

                <span class="k">return</span>

        <span class="c1"># if passes our validation, set list</span>
        <span class="k">if</span> <span class="n">sender</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;rates&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate_list</span> <span class="o">=</span> <span class="n">a_list</span>
        <span class="k">elif</span> <span class="n">sender</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;payloads&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">payload_list</span> <span class="o">=</span> <span class="n">a_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Not sure what list this is, object name is: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sender</span><span class="o">.</span><span class="n">objectName</span><span class="p">()))</span></div></div>











<div class="viewcode-block" id="Calibrate_Water"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Calibrate_Water">[docs]</a><span class="k">class</span> <span class="nc">Calibrate_Water</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A window to calibrate the volume of water dispensed per ms.</span>

<span class="sd">    Warning:</span>
<span class="sd">        Not Implemented</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pilots</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            pilots (:py:attr:`.Terminal.pilots`): A dictionary of pilots</span>
<span class="sd">            message_fn (:py:meth:`.Net_Node.send`): The method the Terminal uses to send messages via its net node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Calibrate_Water</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span> <span class="o">=</span> <span class="n">pilots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pilot_widgets</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

<div class="viewcode-block" id="Calibrate_Water.init_ui"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Calibrate_Water.init_ui">[docs]</a>    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>

        <span class="c1"># Container Widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="c1"># Layout of Container Widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container_layout</span><span class="p">)</span>


        <span class="n">screen_geom</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDesktopWidget</span><span class="p">()</span><span class="o">.</span><span class="n">availableGeometry</span><span class="p">()</span>
        <span class="c1"># get max pixel value for each subwidget</span>
        <span class="n">widget_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">screen_geom</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">-</span><span class="mi">50</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilots</span><span class="p">)))</span>


        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pilots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pilot_widgets</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pilot_Ports</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pilot_widgets</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="n">widget_height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pilot_widgets</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="n">screen_geom</span><span class="o">.</span><span class="n">width</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pilot_widgets</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">container_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot_widgets</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>

        <span class="c1"># Scroll Area Properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QScrollArea</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="p">)</span>

        <span class="c1"># ok/cancel buttons</span>
        <span class="n">buttonBox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="n">buttonBox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">buttonBox</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

        <span class="c1"># prevent from expanding</span>
        <span class="c1"># set max size to screen size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="n">screen_geom</span><span class="o">.</span><span class="n">height</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="n">screen_geom</span><span class="o">.</span><span class="n">width</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scrollArea</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QScrollArea</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollArea</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="Pilot_Ports"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Ports">[docs]</a><span class="k">class</span> <span class="nc">Pilot_Ports</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Each pilot&#39;s ports and buttons to control repeated release.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pilot</span><span class="p">,</span> <span class="n">n_clicks</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">click_dur</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            pilot:</span>
<span class="sd">            message_fn:</span>
<span class="sd">            n_clicks:</span>
<span class="sd">            click_dur:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Pilot_Ports</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pilot</span> <span class="o">=</span> <span class="n">pilot</span>

        <span class="c1"># when starting, stash the duration sent to the pi in case it&#39;s changed during.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># store volumes per dispense here.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">listens</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;CAL_PROGRESS&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_progress</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">Net_Node</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Cal_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot</span><span class="p">),</span>
                             <span class="n">upstream</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span>
                             <span class="n">port</span><span class="o">=</span><span class="n">prefs</span><span class="o">.</span><span class="n">MSGPORT</span><span class="p">,</span>
                             <span class="n">listens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">listens</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

<div class="viewcode-block" id="Pilot_Ports.init_ui"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Ports.init_ui">[docs]</a>    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Init the layout for one pilot&#39;s ports:</span>

<span class="sd">        * pilot name</span>
<span class="sd">        * port buttons</span>
<span class="sd">        * 3 times and vol dispersed</span>
<span class="sd">        *</span>

<span class="sd">        TODO:</span>
<span class="sd">            Don&#39;t assume L/C/R, ask the pilot what it has</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">pilot_lab</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot</span><span class="p">)</span>
        <span class="n">pilot_font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">()</span>
        <span class="n">pilot_font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">pilot_font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">pilot_lab</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">pilot_font</span><span class="p">)</span>
        <span class="n">pilot_lab</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;border: 1px solid black&#39;</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pilot_lab</span><span class="p">)</span>

        <span class="c1"># make param setting boxes</span>
        <span class="n">param_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFormLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_clicks</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_clicks</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_clicks</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIntValidator</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interclick_interval</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interclick_interval</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interclick_interval</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIntValidator</span><span class="p">())</span>

        <span class="n">param_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s2">&quot;n clicks&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_clicks</span><span class="p">)</span>
        <span class="n">param_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s2">&quot;interclick (ms)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interclick_interval</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">param_layout</span><span class="p">)</span>

        <span class="c1"># buttons and fields for each port</span>

        <span class="c1">#button_layout = QtGui.QVBoxLayout()</span>
        <span class="n">vol_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dur_boxes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol_boxes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pbars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flowrates</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">port</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">]):</span>
            <span class="c1"># init empty dict to store volumes and params later</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># button to start calibration</span>
            <span class="n">port_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
            <span class="n">port_button</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
            <span class="n">port_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_calibration</span><span class="p">)</span>
            <span class="n">vol_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">port_button</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># set click duration</span>
            <span class="n">dur_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Click dur (ms)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dur_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dur_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dur_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIntValidator</span><span class="p">())</span>
            <span class="n">vol_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">dur_label</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">vol_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dur_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Divider</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFrame</span><span class="p">()</span>
            <span class="n">divider</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">VLine</span><span class="p">)</span>
            <span class="n">vol_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">divider</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># input dispensed volume</span>
            <span class="n">vol_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Dispensed volume (mL)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDoubleValidator</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">textEdited</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_volumes</span><span class="p">)</span>
            <span class="n">vol_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">vol_label</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">vol_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pbars</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QProgressBar</span><span class="p">()</span>
            <span class="n">vol_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbars</span><span class="p">[</span><span class="n">port</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

            <span class="c1"># display flow rate</span>

            <span class="c1">#self.flowrates[port] = QtGui.QLabel(&#39;?uL/ms&#39;)</span>
            <span class="c1">#self.flowrates[port].setSizePolicy(QtGui.QSizePolicy.Fixed, QtGui.QSizePolicy.Fixed)</span>
            <span class="c1">#vol_layout.addWidget(self.flowrates[port], i, 7)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">vol_layout</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span></div>




<div class="viewcode-block" id="Pilot_Ports.update_volumes"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Ports.update_volumes">[docs]</a>    <span class="k">def</span> <span class="nf">update_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">port</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">open_dur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_params</span><span class="p">[</span><span class="n">port</span><span class="p">][</span><span class="s1">&#39;dur&#39;</span><span class="p">]</span>
            <span class="n">n_clicks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_params</span><span class="p">[</span><span class="n">port</span><span class="p">][</span><span class="s1">&#39;n_clicks&#39;</span><span class="p">]</span>
            <span class="n">click_iti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_params</span><span class="p">[</span><span class="n">port</span><span class="p">][</span><span class="s1">&#39;click_iti&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Volume can only be updated after a calibration has been run&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">vol</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="n">port</span><span class="p">][</span><span class="n">open_dur</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;vol&#39;</span><span class="p">:</span> <span class="n">vol</span><span class="p">,</span>
            <span class="s1">&#39;n_clicks&#39;</span><span class="p">:</span> <span class="n">n_clicks</span><span class="p">,</span>
            <span class="s1">&#39;click_iti&#39;</span><span class="p">:</span> <span class="n">click_iti</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span></div>

        <span class="c1"># set flowrate label</span>
        <span class="c1">#flowrate = ((vol * 1000.0) / n_clicks) / open_dur</span>
        <span class="c1">#frame_geom = self.flowrates[port].frameGeometry()</span>
        <span class="c1">#self.flowrates[port].setMaximumHeight(frame_geom.height())</span>


        <span class="c1">#self.flowrates[port].setText(&quot;{} uL/ms&quot;.format(flowrate))</span>

<div class="viewcode-block" id="Pilot_Ports.start_calibration"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Ports.start_calibration">[docs]</a>    <span class="k">def</span> <span class="nf">start_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>

        <span class="c1"># stash params at the time of starting calibration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_params</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;dur&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dur_boxes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s1">&#39;n_clicks&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_clicks</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
            <span class="s1">&#39;click_iti&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interclick_interval</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pbars</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_params</span><span class="p">[</span><span class="n">port</span><span class="p">][</span><span class="s1">&#39;n_clicks&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pbars</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_params</span><span class="p">[</span><span class="n">port</span><span class="p">]</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;port&#39;</span><span class="p">:</span><span class="n">port</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;CALIBRATE_PORT&quot;</span><span class="p">,</span>
                       <span class="n">value</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pilot_Ports.l_progress"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Pilot_Ports.l_progress">[docs]</a>    <span class="nd">@gui_event</span>
    <span class="k">def</span> <span class="nf">l_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Value should contain</span>

<span class="sd">        * Pilot</span>
<span class="sd">        * Port</span>
<span class="sd">        * Current Click (click_num)</span>

<span class="sd">        :param value:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pbars</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;click_num&#39;</span><span class="p">]))</span></div></div>





<div class="viewcode-block" id="Reassign"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Reassign">[docs]</a><span class="k">class</span> <span class="nc">Reassign</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dialog that lets subjects be batch reassigned to new protocols or steps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subjects</span><span class="p">,</span> <span class="n">protocols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            mice (dict): A dictionary that contains each subject&#39;s protocol and step, ie.::</span>

<span class="sd">                    {&#39;subject_id&#39;:[&#39;protocol_name&#39;, step_int], ... }</span>

<span class="sd">            protocols (list): list of protocol files in the `prefs.PROTOCOLDIR`.</span>
<span class="sd">                Not entirely sure why we don&#39;t just list them ourselves here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Reassign</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mice</span> <span class="o">=</span> <span class="n">mice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span> <span class="o">=</span> <span class="n">protocols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol_dir</span> <span class="o">=</span> <span class="n">prefs</span><span class="o">.</span><span class="n">PROTOCOLDIR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

<div class="viewcode-block" id="Reassign.init_ui"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Reassign.init_ui">[docs]</a>    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes graphical elements.</span>

<span class="sd">        Makes a row for each subject where its protocol and step can be changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subject_objects</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">protocol</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mice</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">mice</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">subject_name</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># subject label</span>
            <span class="n">subject_lab</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(),</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">()]</span>
            <span class="n">protocol_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">protocol_box</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">subject_name</span><span class="p">)</span>
            <span class="n">protocol_box</span><span class="o">.</span><span class="n">insertItems</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span><span class="p">)</span>
            <span class="c1"># set current item if subject has matching protocol</span>
            <span class="n">protocol_bool</span> <span class="o">=</span> <span class="p">[</span><span class="n">protocol</span> <span class="o">==</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">protocol_bool</span><span class="p">):</span>
                <span class="n">protocol_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">protocol_bool</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">protocol_box</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">protocol_ind</span><span class="p">)</span>
            <span class="n">protocol_box</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_protocol</span><span class="p">)</span>

            <span class="n">step_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">step_box</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">subject_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">populate_steps</span><span class="p">(</span><span class="n">subject_name</span><span class="p">)</span>

            <span class="n">step_box</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="n">step_box</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_step</span><span class="p">)</span>

            <span class="c1"># add to layout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">subject_lab</span><span class="p">,</span> <span class="n">i</span><span class="o">%</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">25</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">protocol_box</span><span class="p">,</span> <span class="n">i</span><span class="o">%</span><span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">25</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">step_box</span><span class="p">,</span> <span class="n">i</span><span class="o">%</span><span class="mi">25</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">25</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>



        <span class="n">buttonBox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="n">buttonBox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>
        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">main_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">buttonBox</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">main_layout</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reassign.populate_steps"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Reassign.populate_steps">[docs]</a>    <span class="k">def</span> <span class="nf">populate_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When a protocol is selected, populate the selection box with the steps that can be chosen.</span>

<span class="sd">        Args:</span>
<span class="sd">            subject (str): ID of subject whose steps are being populated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">protocol_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">step_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">while</span> <span class="n">step_box</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">step_box</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Load the protocol and parse its steps</span>
        <span class="n">protocol_str</span> <span class="o">=</span> <span class="n">protocol_box</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">protocol_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol_dir</span><span class="p">,</span> <span class="n">protocol_str</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">protocol_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">protocol_file_open</span><span class="p">:</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">protocol_file_open</span><span class="p">)</span>

        <span class="n">step_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">protocol</span><span class="p">):</span>
            <span class="n">step_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;step_name&#39;</span><span class="p">])</span>

        <span class="n">step_box</span><span class="o">.</span><span class="n">insertItems</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">step_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reassign.set_protocol"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Reassign.set_protocol">[docs]</a>    <span class="k">def</span> <span class="nf">set_protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the protocol is changed, stash that and call :py:meth:`.Reassign.populate_steps` .</span>
<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>
        <span class="n">protocol_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">step_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mice</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">protocol_box</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mice</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">populate_steps</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span></div>


<div class="viewcode-block" id="Reassign.set_step"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Reassign.set_step">[docs]</a>    <span class="k">def</span> <span class="nf">set_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the step is changed, stash that.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>
        <span class="n">protocol_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">step_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_objects</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mice</span><span class="p">[</span><span class="n">subject</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_box</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span></div></div>





<div class="viewcode-block" id="Weights"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Weights">[docs]</a><span class="k">class</span> <span class="nc">Weights</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table for viewing and editing the most recent subject weights.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mice_weights</span><span class="p">,</span> <span class="n">mice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            mice_weights (list): a list of weights of the format returned by</span>
<span class="sd">                :py:meth:`.Subject.get_weight(baseline=True)`.</span>
<span class="sd">            mice (dict): the Terminal&#39;s :py:attr:`.Terminal.subjects` dictionary of :class:`.Subject` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Weights</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mice_weights</span> <span class="o">=</span> <span class="n">mice_weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mice</span> <span class="o">=</span> <span class="n">mice</span> <span class="c1"># subject objects from terminal</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span> <span class="o">=</span> <span class="n">odict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Subject&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Date&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="s1">&#39;baseline_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Baseline&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="s1">&#39;minimum_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Minimum&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Starting Mass&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="s1">&#39;stop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Stopping Mass&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cellChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_weight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed_cells</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># if we change cells, store the row, column and value so terminal can update</span>


<div class="viewcode-block" id="Weights.init_ui"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Weights.init_ui">[docs]</a>    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialized graphical elements. Literally just filling a table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set shape (rows by cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mice_weights</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
                        <span class="n">format_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mice_weights</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">],</span> <span class="s1">&#39;%y%m</span><span class="si">%d</span><span class="s1">-%H%M%S&#39;</span><span class="p">)</span>
                        <span class="n">format_date</span> <span class="o">=</span> <span class="n">format_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">format_date</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span>
                        <span class="n">stop_wt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mice_weights</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">])</span>
                        <span class="n">minimum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mice_weights</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s1">&#39;minimum_mass&#39;</span><span class="p">])</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">stop_wt</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">stop_wt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">minimum</span><span class="p">:</span>
                            <span class="n">item</span><span class="o">.</span><span class="n">setBackground</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mice_weights</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mice_weights</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="c1"># make headers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjustSize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sortItems</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Weights.set_weight"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Weights.set_weight">[docs]</a>    <span class="k">def</span> <span class="nf">set_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the most recent weights in :attr:`.gui.Weights.subjects` objects.</span>

<span class="sd">        Note:</span>
<span class="sd">            Only the daily weight measurements can be changed this way - not subject name, baseline weight, etc.</span>

<span class="sd">        Args:</span>
<span class="sd">            row (int): row of table</span>
<span class="sd">            column (int): column of table</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">column</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span> <span class="c1"># if this is one of the daily weights</span>
            <span class="n">new_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;New value must be able to be coerced to a float! input: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_val</span><span class="p">))</span>
                <span class="k">return</span>

            <span class="c1"># get subject, date and column name</span>
            <span class="n">subject_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mice_weights</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
            <span class="n">column_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">column</span><span class="p">]</span> <span class="c1"># recall colnames is an ordered dictionary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mice</span><span class="p">[</span><span class="n">subject_name</span><span class="p">]</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">new_val</span><span class="p">)</span></div></div>


<span class="c1">#####################################################</span>
<span class="c1"># Custom Autopilot Qt Style</span>

<div class="viewcode-block" id="Autopilot_Style"><a class="viewcode-back" href="../../../autopilot.core.gui.html#autopilot.core.gui.Autopilot_Style">[docs]</a><span class="k">class</span> <span class="nc">Autopilot_Style</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPlastiqueStyle</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Autopilot_Style</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></div>




<span class="c1">###############</span>
<span class="c1"># don&#39;t remove these - will be used to replace Protocol Wizard eventually</span>

<span class="c1">###################################3</span>
<span class="c1"># Parameter setting widgets</span>
<span class="c1">######################################</span>
<span class="c1">#</span>
<span class="c1"># class Parameters(QtGui.QWidget):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     A :class:`QtGui.QWidget` used to display and edit task parameters.</span>
<span class="c1">#</span>
<span class="c1">#     This class is typically instantiated by :class:`Protocol_Parameters`</span>
<span class="c1">#     as a display window for a single step&#39;s parameters.</span>
<span class="c1">#</span>
<span class="c1">#     Attributes:</span>
<span class="c1">#         param_layout (:class:`QtGui.QFormLayout`): Holds param tags and values</span>
<span class="c1">#         param_changes (dict): Stores any changes made to protocol parameters,</span>
<span class="c1">#             used to update the protocol stored in the :class:`~.subject.Subject` object.</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     # Superclass to embed wherever needed</span>
<span class="c1">#     # Subclasses will implement use as standalong dialog and as step selector</span>
<span class="c1">#     # Reads and edits tasks parameters from a subject&#39;s protocol</span>
<span class="c1">#     def __init__(self, params=None, stash_changes=False):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Args:</span>
<span class="c1">#             params (str, collections.OrderedDict): If a string, the name of a task in :py:data:`.tasks.TASK_LIST`</span>
<span class="c1">#</span>
<span class="c1">#                 If an odict, an odict of the form used by</span>
<span class="c1">#                 :py:attr:`.Task.PARAMS` (see :py:attr:`.Nafc.PARAMS` for an example).</span>
<span class="c1">#</span>
<span class="c1">#                 we use an OrderedDict to preserve the order of some parameters that should appear together</span>
<span class="c1">#</span>
<span class="c1">#                 its general structure is::</span>
<span class="c1">#</span>
<span class="c1">#                     {&#39;parameter_key&#39;: {&#39;tag&#39;:&#39;Human Readable Name&#39;,</span>
<span class="c1">#                                        &#39;type&#39;:&#39;param_type&#39;}}</span>
<span class="c1">#</span>
<span class="c1">#                 while some parameter types have extra items, eg.::</span>
<span class="c1">#</span>
<span class="c1">#                     {&#39;list_param&#39;: {&#39;tag&#39;:&#39;Select from a List of Parameters&#39;,</span>
<span class="c1">#                                     &#39;type&#39;: &#39;list&#39;,</span>
<span class="c1">#                                     &#39;values&#39;: {&#39;First Option&#39;:0, &#39;Second Option&#39;:1}}</span>
<span class="c1">#</span>
<span class="c1">#                 where k:v pairs are still used with lists to allow parameter values (0, 1) be human readable.</span>
<span class="c1">#</span>
<span class="c1">#                 The available types include:</span>
<span class="c1">#                 - **int** - integer</span>
<span class="c1">#                 - **bool** - boolean boolbox</span>
<span class="c1">#                 - **list** - a list of `values` to choose from</span>
<span class="c1">#                 - **sounds** - a :class:`Sound_Widget` that allows sounds to be defined.</span>
<span class="c1">#</span>
<span class="c1">#             stash_changes (bool): Should changes to parameters be stored in :py:attr:`Parameters.param_changes` ?</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         super(Parameters, self).__init__()</span>
<span class="c1">#</span>
<span class="c1">#         # We&#39;re just a simple label and a populateable form layout</span>
<span class="c1">#         self.layout = QtGui.QVBoxLayout()</span>
<span class="c1">#         self.setLayout(self.layout)</span>
<span class="c1">#</span>
<span class="c1">#         label = QtGui.QLabel(&quot;Parameters&quot;)</span>
<span class="c1">#         label.setFixedHeight(40)</span>
<span class="c1">#</span>
<span class="c1">#         self.param_layout = QtGui.QFormLayout()</span>
<span class="c1">#</span>
<span class="c1">#         self.layout.addWidget(label)</span>
<span class="c1">#         self.layout.addLayout(self.param_layout)</span>
<span class="c1">#</span>
<span class="c1">#         # sometimes we only are interested in the changes - like editing params</span>
<span class="c1">#         # when that&#39;s the case, we keep a log of it</span>
<span class="c1">#         self.stash_changes = stash_changes</span>
<span class="c1">#         if self.stash_changes:</span>
<span class="c1">#             self.param_changes = {}</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#         # If we were initialized with params, populate them now</span>
<span class="c1">#         self.params = None</span>
<span class="c1">#         if params:</span>
<span class="c1">#             self.populate_params(params)</span>
<span class="c1">#</span>
<span class="c1">#     def populate_params(self, params):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Calls :py:meth:`clear_layout` and then creates widgets to edit parameter values.</span>
<span class="c1">#</span>
<span class="c1">#         Args:</span>
<span class="c1">#             params (str, collections.OrderedDict): see `params` in the class instantiation arguments.</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         # We want to hang on to the protocol and step</span>
<span class="c1">#         # because they are direct references to the subject file,</span>
<span class="c1">#         # but we don&#39;t need to have them passed every time</span>
<span class="c1">#</span>
<span class="c1">#         self.clear_layout(self.param_layout)</span>
<span class="c1">#</span>
<span class="c1">#         if isinstance(params, basestring):</span>
<span class="c1">#             # we are filling an empty parameter set</span>
<span class="c1">#             self.params = {}</span>
<span class="c1">#             task_type = params</span>
<span class="c1">#         else:</span>
<span class="c1">#             # we are populating an existing parameter set (ie. the fields already have values)</span>
<span class="c1">#             self.params = params</span>
<span class="c1">#             task_type = params[&#39;task_type&#39;]</span>
<span class="c1">#</span>
<span class="c1">#         self.param_layout.addRow(&quot;Task Type:&quot;, QtGui.QLabel(task_type))</span>
<span class="c1">#</span>
<span class="c1">#         # we need to load the task class to get the types of our parameters,</span>
<span class="c1">#         self.task_params = copy.deepcopy(tasks.TASK_LIST[task_type].PARAMS)</span>
<span class="c1">#</span>
<span class="c1">#         # Make parameter widgets depending on type and populate with current values</span>
<span class="c1">#         for k, v in self.task_params.items():</span>
<span class="c1">#             if v[&#39;type&#39;] == &#39;int&#39; or v[&#39;type&#39;] == &#39;str&#39;:</span>
<span class="c1">#                 rowtag = QtGui.QLabel(v[&#39;tag&#39;])</span>
<span class="c1">#                 input_widget = QtGui.QLineEdit()</span>
<span class="c1">#                 input_widget.setObjectName(k)</span>
<span class="c1">#                 if v[&#39;type&#39;] == &#39;int&#39;:</span>
<span class="c1">#                     input_widget.setValidator(QtGui.QIntValidator())</span>
<span class="c1">#                 input_widget.textEdited.connect(self.set_param)</span>
<span class="c1">#                 if k in self.params.keys():</span>
<span class="c1">#                     input_widget.setText(self.params[k])</span>
<span class="c1">#                 self.param_layout.addRow(rowtag,input_widget)</span>
<span class="c1">#             elif v[&#39;type&#39;] == &#39;bool&#39;:</span>
<span class="c1">#                 rowtag = QtGui.QLabel(v[&#39;tag&#39;])</span>
<span class="c1">#                 input_widget = QtGui.QCheckBox()</span>
<span class="c1">#                 input_widget.setObjectName(k)</span>
<span class="c1">#                 input_widget.stateChanged.connect(self.set_param)</span>
<span class="c1">#                 if k in self.params.keys():</span>
<span class="c1">#                     input_widget.setChecked(self.params[k])</span>
<span class="c1">#                 self.param_layout.addRow(rowtag, input_widget)</span>
<span class="c1">#             elif v[&#39;type&#39;] == &#39;list&#39;:</span>
<span class="c1">#                 rowtag = QtGui.QLabel(v[&#39;tag&#39;])</span>
<span class="c1">#                 input_widget = QtGui.QListWidget()</span>
<span class="c1">#                 input_widget.setObjectName(k)</span>
<span class="c1">#                 input_widget.insertItems(0, sorted(v[&#39;values&#39;], key=v[&#39;values&#39;].get))</span>
<span class="c1">#                 input_widget.itemSelectionChanged.connect(self.set_param)</span>
<span class="c1">#                 if k in self.params.keys():</span>
<span class="c1">#                     select_item = input_widget.item(self.params[k])</span>
<span class="c1">#                     input_widget.setCurrentItem(select_item)</span>
<span class="c1">#                 self.param_layout.addRow(rowtag, input_widget)</span>
<span class="c1">#             elif v[&#39;type&#39;] == &#39;sounds&#39;:</span>
<span class="c1">#                 self.sound_widget = Sound_Widget()</span>
<span class="c1">#                 self.sound_widget.setObjectName(k)</span>
<span class="c1">#                 self.sound_widget.pass_set_param_function(self.set_sounds)</span>
<span class="c1">#                 self.param_layout.addRow(self.sound_widget)</span>
<span class="c1">#                 if k in self.params.keys():</span>
<span class="c1">#                     self.sound_widget.populate_lists(self.params[k][&#39;sounds&#39;])</span>
<span class="c1">#             elif v[&#39;type&#39;] == &#39;label&#39;:</span>
<span class="c1">#                 # This is a .json label not for display</span>
<span class="c1">#                 pass</span>
<span class="c1">#</span>
<span class="c1">#     def clear_layout(self, layout=None):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Clears widgets from current layout</span>
<span class="c1">#</span>
<span class="c1">#         Args:</span>
<span class="c1">#             layout (:class:`QtGui.QLayout`): optional. if `None`, clears `param_layout`,</span>
<span class="c1">#             otherwise clears the passed layout.</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         if not layout:</span>
<span class="c1">#             layout = self.param_layout</span>
<span class="c1">#         while layout.count():</span>
<span class="c1">#             child = layout.takeAt(0)</span>
<span class="c1">#             if child.widget():</span>
<span class="c1">#                 child.widget().deleteLater()</span>
<span class="c1">#</span>
<span class="c1">#     def set_param(self):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Callback function connected to the signal each widget uses to signal it has changed.</span>
<span class="c1">#</span>
<span class="c1">#         Identifies the param that was changed, gets the current value, updates `self.param` and</span>
<span class="c1">#         `self.param_changes` if `stash_changes` is True.</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         # A param was changed in the window, update our values here and in the subject object</span>
<span class="c1">#         sender = self.sender()</span>
<span class="c1">#         param_name = sender.objectName()</span>
<span class="c1">#         sender_type = self.task_params[param_name][&#39;type&#39;]</span>
<span class="c1">#</span>
<span class="c1">#         if sender_type == &#39;int&#39; or sender_type == &#39;str&#39;:</span>
<span class="c1">#             new_val = sender.text()</span>
<span class="c1">#         elif sender_type == &#39;bool&#39;:</span>
<span class="c1">#             new_val = sender.isChecked()</span>
<span class="c1">#         elif sender_type == &#39;list&#39;:</span>
<span class="c1">#             list_text = sender.currentItem().text()</span>
<span class="c1">#             new_val = self.task_params[param_name][&#39;values&#39;][list_text]</span>
<span class="c1">#         elif sender_type == &#39;sounds&#39;:</span>
<span class="c1">#             new_val = self.sound_widget.sound_dict</span>
<span class="c1">#</span>
<span class="c1">#         self.params[param_name] = new_val</span>
<span class="c1">#         if self.stash_changes:</span>
<span class="c1">#             self.param_changes[param_name] = new_val</span>
<span class="c1">#</span>
<span class="c1">#     def set_sounds(self):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Stores parameters that define sounds.</span>
<span class="c1">#</span>
<span class="c1">#         Sound parameters work a bit differently, speficically we have to retrieve</span>
<span class="c1">#         :py:attr:`.Sound_Widget.sound_dict`.</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         # Have to handle sounds slightly differently</span>
<span class="c1">#         # because the sound widget updates its own parameters</span>
<span class="c1">#         self.params[self.step][&#39;sounds&#39;] = self.sound_widget.sound_dict</span>

<span class="c1">#</span>
<span class="c1"># class Protocol_Parameters(QtGui.QWidget):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Allows the creation of multi-step protocols.</span>
<span class="c1">#</span>
<span class="c1">#     Composed of three windows:</span>
<span class="c1">#     - **left**: possible task types from :py:data:`.tasks.TASK_LIST`</span>
<span class="c1">#     - **center**: current steps in task</span>
<span class="c1">#     - **right**: :class:`.Parameters` for currently selected step.</span>
<span class="c1">#</span>
<span class="c1">#     Attributes:</span>
<span class="c1">#         protocol (dict)</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#     def __init__(self, protocol, step, protocol_name=None):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Args:</span>
<span class="c1">#             protocol:</span>
<span class="c1">#             step:</span>
<span class="c1">#             protocol_name:</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         super(Protocol_Parameters, self).__init__()</span>
<span class="c1">#</span>
<span class="c1">#         self.protocol = protocol</span>
<span class="c1">#         self.step = step</span>
<span class="c1">#</span>
<span class="c1">#         # We&#39;re just a Parameters window with a combobox that lets us change step</span>
<span class="c1">#         self.layout = QtGui.QVBoxLayout()</span>
<span class="c1">#         self.setLayout(self.layout)</span>
<span class="c1">#</span>
<span class="c1">#         if protocol_name:</span>
<span class="c1">#             label = QtGui.QLabel(protocol_name)</span>
<span class="c1">#         else:</span>
<span class="c1">#             label = QtGui.QLabel(&#39;Protocol Parameters&#39;)</span>
<span class="c1">#</span>
<span class="c1">#         label.setFixedHeight(20)</span>
<span class="c1">#</span>
<span class="c1">#         # Make a combobox, we&#39;ll populate it in a second.</span>
<span class="c1">#         self.step_selection = QtGui.QComboBox()</span>
<span class="c1">#         self.step_selection.currentIndexChanged.connect(self.step_changed)</span>
<span class="c1">#</span>
<span class="c1">#         # And the rest of our body is the params window</span>
<span class="c1">#         self.params_widget = Parameters(stash_changes=True)</span>
<span class="c1">#         self.step_changes = []</span>
<span class="c1">#</span>
<span class="c1">#         # Add everything to the layout</span>
<span class="c1">#         self.layout.addWidget(label)</span>
<span class="c1">#         self.layout.addWidget(self.step_selection)</span>
<span class="c1">#         self.layout.addWidget(self.params_widget)</span>
<span class="c1">#</span>
<span class="c1">#         # and populate</span>
<span class="c1">#         self.populate_protocol(self.protocol, self.step)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#     def populate_protocol(self, protocol, step=0):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Args:</span>
<span class="c1">#             protocol:</span>
<span class="c1">#             step:</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         # clean up first</span>
<span class="c1">#         self.clear()</span>
<span class="c1">#</span>
<span class="c1">#         # store in case things have changed since init</span>
<span class="c1">#         self.protocol = protocol</span>
<span class="c1">#         self.step = step</span>
<span class="c1">#</span>
<span class="c1">#         if isinstance(self.protocol, basestring):</span>
<span class="c1">#             # If we were passed a string, we&#39;re being passed a path to a protocol</span>
<span class="c1">#             with open(self.protocol, &#39;r&#39;) as protocol_file:</span>
<span class="c1">#                 self.protocol = json.load(protocol_file)</span>
<span class="c1">#</span>
<span class="c1">#         # Get step list and a dict to convert names back to ints</span>
<span class="c1">#         self.step_list = []</span>
<span class="c1">#         self.step_ind  = {}</span>
<span class="c1">#         for i, s in enumerate(self.protocol):</span>
<span class="c1">#             self.step_list.append(s[&#39;step_name&#39;])</span>
<span class="c1">#             self.step_ind[s[&#39;step_name&#39;]] = i</span>
<span class="c1">#         # fill step_changes with empty dicts to be able to assign later</span>
<span class="c1">#         self.step_changes = [{} for i in range(len(self.protocol))]</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#         # Add steps to combobox</span>
<span class="c1">#         # disconnect indexChanged trigger first so we don&#39;t fire a billion times</span>
<span class="c1">#         self.step_selection.currentIndexChanged.disconnect(self.step_changed)</span>
<span class="c1">#         self.step_selection.insertItems(0, self.step_list)</span>
<span class="c1">#         self.step_selection.currentIndexChanged.connect(self.step_changed)</span>
<span class="c1">#</span>
<span class="c1">#         # setting the current index should trigger the params window to refresh</span>
<span class="c1">#         self.step_selection.setCurrentIndex(self.step)</span>
<span class="c1">#         self.params_widget.populate_params(self.protocol[self.step])</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#     def clear(self):</span>
<span class="c1">#         while self.step_selection.count():</span>
<span class="c1">#             self.step_selection.removeItem(0)</span>
<span class="c1">#</span>
<span class="c1">#         self.params_widget.clear_layout()</span>
<span class="c1">#</span>
<span class="c1">#     def step_changed(self):</span>
<span class="c1">#         # save any changes to last step</span>
<span class="c1">#         if self.params_widget.params:</span>
<span class="c1">#             self.protocol[self.step] = self.params_widget.params</span>
<span class="c1">#         if self.params_widget.stash_changes:</span>
<span class="c1">#             self.step_changes[self.step].update(self.params_widget.param_changes)</span>
<span class="c1">#</span>
<span class="c1">#         # the step was changed! Change our parameters here and update the subject object</span>
<span class="c1">#         self.step = self.step_selection.currentIndex()</span>
<span class="c1">#</span>
<span class="c1">#         self.params_widget.populate_params(self.protocol[self.step])</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># class Protocol_Parameters_Dialogue(QtGui.QDialog):</span>
<span class="c1">#     def __init__(self, protocol, step):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Args:</span>
<span class="c1">#             protocol:</span>
<span class="c1">#             step:</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         super(Protocol_Parameters_Dialogue, self).__init__()</span>
<span class="c1">#</span>
<span class="c1">#         # Dialogue wrapper for Protocol_Parameters</span>
<span class="c1">#</span>
<span class="c1">#         self.protocol = protocol</span>
<span class="c1">#         self.step = step</span>
<span class="c1">#</span>
<span class="c1">#         # Since we share self.protocol, updates in the widget should propagate to us</span>
<span class="c1">#         self.protocol_widget = Protocol_Parameters(self.protocol, self.step)</span>
<span class="c1">#</span>
<span class="c1">#         # We stash changes in the protocol widget and recover them on close</span>
<span class="c1">#         self.step_changes = None</span>
<span class="c1">#</span>
<span class="c1">#         # ok/cancel buttons</span>
<span class="c1">#         buttonBox = QtGui.QDialogButtonBox(QtGui.QDialogButtonBox.Ok | QtGui.QDialogButtonBox.Cancel)</span>
<span class="c1">#         buttonBox.accepted.connect(self.accept)</span>
<span class="c1">#         buttonBox.rejected.connect(self.reject)</span>
<span class="c1">#</span>
<span class="c1">#         self.layout = QtGui.QVBoxLayout()</span>
<span class="c1">#         self.layout.addWidget(self.protocol_widget)</span>
<span class="c1">#         self.layout.addWidget(buttonBox)</span>
<span class="c1">#         self.setLayout(self.layout)</span>
<span class="c1">#</span>
<span class="c1">#         self.setWindowTitle(&quot;Edit Protocol Parameters&quot;)</span>
<span class="c1">#</span>
<span class="c1">#     def accept(self):</span>
<span class="c1">#         # Get the changes from the currently open params window</span>
<span class="c1">#         self.step_changes = self.protocol_widget.step_changes</span>
<span class="c1">#         # And any since the last time the qcombobox was changed</span>
<span class="c1">#         self.step_changes[self.protocol_widget.step].update(self.protocol_widget.params_widget.param_changes)</span>
<span class="c1">#</span>
<span class="c1">#         # call the rest of the accept method</span>
<span class="c1">#         super(Protocol_Parameters_Dialogue, self).accept()</span>

<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># class Popup(QtGui.QDialog):</span>
<span class="c1">#     def __init__(self, message):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Args:</span>
<span class="c1">#             message:</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         super(Popup, self,).__init__()</span>
<span class="c1">#         self.layout = QtGui.QVBoxLayout()</span>
<span class="c1">#         self.text = QtGui.QLabel(message)</span>
<span class="c1">#         self.layout.addWidget(self.text)</span>
<span class="c1">#         self.setLayout(self.layout)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jonny Saunders

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>